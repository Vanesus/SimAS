%==================================================================================
%   Anexo B: Analisis descendente
%==================================================================================

\chapter {Análisis Sintáctico Descendente Predictivo}

\section{Introducción}

El análisis sintáctico descendente predictivo indica que no hay retroceso en la construcción del Árbol.
Cuando existe más de una regla, se selecciona previamente la correcta, para así­ no tener que volver atrás.

En este método se pretende construir una tabla predictiva. Para ello, hay que seguir los pasos especificados en la Figura \ref{FiguraB11}.

\begin{figure}[h]
	\begin{center}
        \includegraphics[scale=0.5]{img/predictivo.jpg} 
        \caption{Pasos construcción tabla predictiva}
       \label{FiguraB11}
	\end{center}
  \end{figure}
  
\section{Caracterización de gramáticas LL o LL(k)}

Una gramática se dice que es LL si en la tabla predictiva no hay \textit{conflicto}. Se produce un conflicto cuando hay dos o más valores en una celda.

\begin{itemize}
\item \textit{Left}: cadena de entrada de izquierda a derecha.
\item \textit{Left}: derivación por la izquierda de dicha cadena de entrada, se intenta construir un Árbol descendente.
\item \textit{k}: número de componentes léxicos de la entrada que se van a utilizar para determinar cual es la siguiente regla que se debe aplicar. En el caso general k=1.
\end{itemize}

\subsection{Propiedades}

Las propiedades de las gramáticas LL son:

\begin{enumerate}
\item 
	Si $A \rightarrow \alpha \in P \wedge A \rightarrow \beta \in P (2reglas)$ \\
  \begin{equation}	
   	entonces \not\exists \:a \in V_{T} \:al \:que
	\left\{\begin{matrix}
			A \Rightarrow \alpha \overset{*}{\Rightarrow} \:\underline{a} \gamma \\ 
			A \Rightarrow \beta \overset{*}{\Rightarrow} \:\underline{a} \delta  
	\end{matrix}\right.
	\end{equation}
   \\es decir $\not\exists \:a \in V_{T} \wedge \:a \in \:primero \:(\alpha\:) \cup \:primero \:(\beta\:)$
   
\item
	Si $A \rightarrow \alpha \in \:P \wedge \:A \rightarrow \beta \in \:P$
   \begin{equation}
    entonces 
    	\left\{\begin{matrix}
    	     \:Si\:\alpha \overset{*}{\Rightarrow} \varepsilon \:entonces \not\exists \beta \overset{*}{\Rightarrow} \varepsilon \\
    	     \:Si\:\beta \overset{*}{\Rightarrow} \varepsilon \:entonces \not\exists \alpha \overset{*}{\Rightarrow} \varepsilon 
    	\end{matrix}\right.
   \end{equation}    
   
\item 
	  \begin{equation}
	   \begin{split}
	   \:Si \:A \rightarrow \alpha \in \:P \:y \:(\:A \rightarrow \beta \in \:P \wedge \beta \overset{*}{\Rightarrow} \varepsilon \:) \\
	  & \:entonces \not\exists \:a\: \varepsilon \:V_{T} \:tal \:que \: \alpha \overset{*}{\Rightarrow} \:a \gamma  \\
	  & \:y \:a \:\varepsilon \:siguiente \:(\:A\:)
	   \end{split}
	  \end{equation}
	  
	 \textit{a} $\in$ siguiente (A) si \textit{a} aparece justamente detrás en cualquier momento de \textit{A} en alguna derivación.
	 
	 S $\overset{+}{\Rightarrow}$ x A a $\delta \overset{*}{\Rightarrow}$ x A $\vartheta$
  
\end{enumerate}

A continuación, se va a mostrar un ejemplo de la propiedad número dos descrita anteriormente:

\begin{equation}
    \begin{array}{l}    
	\displaystyle P = \{ \\
	\displaystyle (1) \:\:\: S \rightarrow a \: A \: D  \\
	\displaystyle (2) \:\:\: S \rightarrow \epsilon \\
	\displaystyle (3) \:\:\: A \rightarrow B \: C \\
	\displaystyle (4) \:\:\: B \rightarrow \epsilon \\
	\displaystyle (5) \:\:\: C \rightarrow \epsilon \\
	\displaystyle \}
    \end{array} 
  \end{equation} 
  
 A $\Rightarrow \epsilon$
 
 A $\Rightarrow$ B C $\Rightarrow$ C $\epsilon$
 
 Aparece un conflicto en la tabla (Ambigua).
 
 Si se produce este caso, no existe ni análisis descendente ni ascendente.
 
 S $\overset{*}{\Rightarrow} \delta$ A a $\vartheta$ 
 
 S $\overset{*}{\Rightarrow} \delta$ A \$
 
 S $\overset{*}{\Rightarrow} \delta$ A $\gamma$ a $\vartheta$
 
 $\overset{*}{\Rightarrow} \delta$ A a $\vartheta$
 
  
Posteriormente, se propone un ejemplo de la propiedad 3:

\begin{equation}
    \begin{array}{l}    
	\displaystyle P = \{ \\
	\displaystyle (1) \:\:\: S \rightarrow B \: A \: C \: D  \\
	\displaystyle (2) \:\:\: C \rightarrow \epsilon \\
	\displaystyle (3) \:\:\: D \rightarrow a \: B \\
	\displaystyle \}
    \end{array} 
  \end{equation} 

Si no se cumpliera la propiedad 3:

A $\Rightarrow \alpha \overset{*}{\Rightarrow}$ a $\delta$

A $\Rightarrow \beta \overset{*}{\Rightarrow} \epsilon$

a $\epsilon$ siguiente (A)

S $\overset{*}{\Rightarrow} \delta$ A a $\vartheta$

\section{Funciones primero y siguiente}

La funcion \textit{primero($\alpha$)} obtiene los sí­mbolos que puede derivar de $\alpha$ y que ocupen la
primera posición, o derivan la palabra vací­a.

\begin{equation}
  \:Primero (\alpha) = \{ \:a \mid \:a \in \:V_{T} \wedge \alpha \overset{*}{\rightarrow} \:a \beta \} \cup \{\epsilon \mid \alpha \overset{*}{\Rightarrow} \epsilon \}
\end{equation}

$\alpha \in V^* = (V_{N} \cup V_{T} )^*$

La funcion \textit{siguiente(A)} está compuesta por aquellos sí­mbolos que pueden seguir a A en
una derivación.

\begin{equation}
  \:Siguiente (A) = \{ \:a \mid \:a \in V_{T} \wedge \:S \overset{+}{\Rightarrow} \alpha \:A \:a \beta \} \cup \{ \$ \mid \:S \overset{+}{\Rightarrow} \alpha \:A \}
\end{equation}

$\:A \in V_{N}$

El conjunto siguiente nunca contiene $\epsilon$.

\subsection{Cálculo de Primero($\alpha$)}

\begin{itemize}
\item \textbf{Caso 1:} \\
		$\alpha \in V_{T}$ donde $\alpha$ es un sÃ­mbolo terminal. \\
		$\alpha \overset{0}{\Rightarrow}$ a ; primero($\alpha$) = \{$\alpha$\} \\
		$\alpha \Rightarrow$ a $\in V_{T}$ ; primero($\alpha$) = \{a\} 
		
\item \textbf{Caso 2:} \\
		$\alpha$ = A $\in V_{N}$ \\
		\begin{itemize}
			\item[a)] Si A $\rightarrow \epsilon \in$ P ; $\epsilon \in$ primero(A) 
			\item[b)] Si A $\rightarrow X_{1} X_{2} \cdots X_{N} \in$ P \\
			 $X_{i} \in$ V = $\alpha \in V_{N} \cup V_{T}$ primero($X_{1}$) - \{$\epsilon$\} $\subseteq$ primero(A) \\ 
			 Si $\epsilon \in$ primero($X_{1}$) $\Rightarrow$ primero($X_{2}$) - \{$\epsilon$\} $\subseteq$ primero(A) \\ 
			 Se repite iterativamente hasta que: \\
			 Si $\epsilon \in$ primero($X_{N-1}$) $\Rightarrow$ primero($X_{N}$) - \{$\epsilon$\} $\subseteq$ primero(A) \\ 
			Si $\epsilon \in$ primero($X_{i}$) $\forall$i $\in$ \{1,2,$\cdots$,N\} $\Rightarrow \epsilon \in$ primero(A)
		
		\end{itemize}
		
\item \textbf{Caso 3:} \\
			$\alpha \rightarrow X_{1}X_{2} \cdots X_{N} \in V^*$ = ($V_{N} \cup V_{T})^*$ \\
			$\alpha$ = aAbC primero($X_{1}$) - \{$\epsilon$\} $\subseteq$ primero($\alpha$) \\
			Si $\alpha \in$ primero($X_{1}$) $\Rightarrow$ primero($X_{2}$) - \{$\epsilon$\} $\subseteq$ primero($\alpha$) \\
			 Se repite iterativamente hasta que: \\
			 Si $\epsilon \in$ primero($X_{N-1}$) $\Rightarrow$ primero($X_{N}$) - \{$\epsilon$\} $\subseteq$ primero($\alpha$) \\ 
			Si $\epsilon \in$ primero($X_{i}$) $\forall$i $\in$ \{1,2,$\cdots$,N\} $\Rightarrow \epsilon \in$ primero($\alpha$)

\end{itemize}

\textbf{\Large{Ejemplo 1}}

A continuación se muestra un ejemplo de gramática (\ref{ejprimero}) y los pasos necesarios para el cálculo de Primero($\alpha$).


\begin{equation}
    \begin{array}{l}    
	\displaystyle P = \{ \\
	\displaystyle (1) \:\:\: E \rightarrow T \: E'  \\
	\displaystyle (2) \:\:\: E' \rightarrow + \: T \: E' \\
	\displaystyle (3) \:\:\: E' \rightarrow \epsilon \\
	\displaystyle (4) \:\:\: T \rightarrow F \: T' \\
	\displaystyle (5) \:\:\: T' \rightarrow * \: F\: T' \\
	\displaystyle (6) \:\:\: T' \rightarrow \epsilon \\
	\displaystyle (7) \:\:\: F \rightarrow (\: E \:) \\
	\displaystyle (8) \:\:\: F \rightarrow identificador \\
	\displaystyle (9) \:\:\: F \rightarrow numero \\
	\displaystyle \}
    \end{array} 
     \label{ejprimero}
  \end{equation} 

\begin{enumerate}
\item E $\rightarrow$ T E' \\
		A $\rightarrow X_{1}X_{2} \cdots X_{N}$ \\
		primero(T) - \{$\epsilon$\} $\subseteq$ primero (E)
		
\item E' $\rightarrow$ + T E' \\
		A $\rightarrow X_{1}X_{2}X_{3}$ \\
		primero (+) - \{$\epsilon$\} = \{+\} $\subseteq$ primero (E') \\
		Como + $\subseteq V_{N}$, no genera $\epsilon$. En la práctica, + se incluye directamente en la tabla.
		
\item E' $\rightarrow \epsilon$ se incluye en la tabla.

\item T $\rightarrow$ F T'\\
		A $\rightarrow X_{1}X_{2}$ \\
		primero (F) - \{$\epsilon$\} $\subseteq$ primero (T)
		
\item T' $\rightarrow$ * F T' \\
		A $\rightarrow X_{1}X_{2}X_{3}$ \\
		primero (*) - \{$\epsilon$\} = \{*\} $\subseteq$ primero (T')
		
\item T' $\rightarrow \epsilon$ se incluye en la tabla.

\item F $\rightarrow$ (E) \\
		A $\rightarrow X_{1}X_{2}X_{3}$ \\
		primero (() - \{$\epsilon$\} = \{(\}$\subseteq$ primero (F)
		
\item F $\rightarrow$ identificador se incluye en la tabla.

\item F $\rightarrow$ número se incluye en la tabla.
		
\end{enumerate}

Por último, en la Tabla \ref{tablaB_1} se muestra el conjunto de primeros que genera la gramática del ejemplo.



\begin{table}[H]
\begin{center}
 \label{tablaB_1}
 \caption{Conjunto primero ejemplo 1}

\begin{tabular}[c]{| c | c | }
\hline
  & \textbf{PRIMERO} \\ \hline
 E & (, identificador, número \\ \hline
 E' & +, $\epsilon$ \\ \hline
 T & (, identificador, número \\ \hline
 T' & *, $\epsilon$ \\ \hline
 F & (, identificador, número \\ \hline
 
\end{tabular}

\end{center}

\end{table}


\textbf{\Large{Ejemplo 2}}

En este apartado se muestra otro ejemplo del cálculo del conjunto primero de la gramática \ref{ejprimero2}.

\begin{equation}
    \begin{array}{l}    
	\displaystyle P = \{ \\
	\displaystyle (1) \:\:\: S \rightarrow A \: b \: B  \\
	\displaystyle (2) \:\:\: A \rightarrow C \: D \: a \\
	\displaystyle (3) \:\:\: B \rightarrow C \: D \\
	\displaystyle (4) \:\:\: B \rightarrow a \\
	\displaystyle (5) \:\:\: C \rightarrow \epsilon \\
	\displaystyle (6) \:\:\: C \rightarrow c \\
	\displaystyle (7) \:\:\: D \rightarrow \epsilon \\
	\displaystyle (8) \:\:\: D \rightarrow d \\
	\displaystyle \}
    \end{array} 
     \label{ejprimero2}
  \end{equation} 

\begin{enumerate}

\item S $\rightarrow$ AbB \\
		primero (A) - \{$\epsilon$\} $\subseteq$ primero (S) 
		
\item A $\rightarrow$ CDa \\
		primero (C) - \{$\epsilon$\} $\subseteq$ primero (A) \\
		Como $\epsilon \: \in$ primero (C) $\Rightarrow$ primero (D) - \{$\epsilon$\} $\subseteq$ primero (A) \\
		Como $\epsilon \: \in$ primero (D) $\Rightarrow$ primero (a) - \{$\epsilon$\} $\subseteq$ primero (A) \\
		
\item B $\rightarrow$ CD \\
		primero (C) - \{$\epsilon$\} $\subseteq$ primero (B) \\
		Como $\epsilon \: \in$ primero (C) $\Rightarrow$ primero (D) - \{$\epsilon$\} $\subseteq$ primero (B) \\
		Como $\epsilon \: \in$ primero (D) $\Rightarrow$ $\epsilon$ $\subseteq$ primero (B) \\
		
\end{enumerate}

\begin{table}[H]
\begin{center}
 \label{tablaB_2}
 \caption{Conjunto primero ejemplo 2}

\begin{tabular}[c]{| c | c | }
\hline
  & \textbf{PRIMERO} \\ \hline
 S & a, d, c \\ \hline
 A & a, d, c \\ \hline
 B & $\epsilon$, a, d, c \\ \hline
 C & $\epsilon$, c \\ \hline
 D & $\epsilon$, d \\ \hline
 
\end{tabular}

\end{center}

\end{table}

\textbf{\Large{Ejemplo 3}}

\begin{equation}
    \begin{array}{l}    
	\displaystyle P = \{ \\
	\displaystyle (1) \:\:\: S \rightarrow D \: S'  \\
	\displaystyle (2) \:\:\: S' \rightarrow D \: S' \\
	\displaystyle (3) \:\:\: S' \rightarrow \epsilon \\
	\displaystyle (4) \:\:\: D \rightarrow T \: L'\: ;  \\
	\displaystyle (5) \:\:\: T \rightarrow int \\
	\displaystyle (6) \:\:\: T \rightarrow float \\
	\displaystyle (7) \:\:\: L \rightarrow id\: L' \\
	\displaystyle (8) \:\:\: L' \rightarrow id\: L' \\
	\displaystyle (9) \:\:\: L' \rightarrow \epsilon \\
	\displaystyle \}
    \end{array} 
     \label{ejprimero3}
  \end{equation} 

\begin{enumerate}
\item S $\rightarrow$ D S' \\
		primero (D) - \{$\epsilon$\} $\subseteq$ primero (S) \\
		
\item S' $\rightarrow$ D S' \\
		primero (D) - \{$\epsilon$\} $\subseteq$ primero (S') \\	
		Como $\epsilon \: \in$ primero (D) $\Rightarrow$ $\epsilon \: \in$ primero (D)
		
\item D $\rightarrow$ T L ; \\
		primero (T) - \{$\epsilon$\} $\subseteq$ primero (D) \\

\end{enumerate}

\begin{table}[H]
\begin{center}
 \label{tablaB_3}
 \caption{Conjunto primero ejemplo 3}

\begin{tabular}[c]{| c | c | }
\hline
  & \textbf{PRIMERO} \\ \hline
 S & int, float \\ \hline
 S' & $\epsilon$, int, float \\ \hline
 D & int, float \\ \hline
 T & int, float \\ \hline
 L & id \\ \hline
 L' & ;, $\epsilon$ \\ \hline
 
\end{tabular}

\end{center}

\end{table}



\subsection{Cálculo de Siguiente(A)}

\begin{itemize}
\item \textbf{Caso 1:} \\
		Si A = S entonces \$ $\in$ siguiente (S)
		
\item \textbf{Caso 2:} \\
		Si A $\rightarrow \: \alpha \: B \: \beta \in \: P \Rightarrow$ primero ($\beta$) - \{$\epsilon$\} $\in$ siguiente (B)
		
\item \textbf{Caso 3:} \\
		Si A $\rightarrow \: \alpha \: B \in$ P ó (A $\rightarrow \: \alpha \: B \beta \in \:P \:y \epsilon \: \in$ primero ($\beta$)) $\Rightarrow$ siguiente (A) $\in$ siguiente (B)

\end{itemize}


\textbf{\Large{Ejemplo }}

A continuación se muestra un ejemplo de gramática (\ref{ejsiguiente1}) y los pasos necesarios para el cálculo de Siguiente(A).

\begin{equation}
    \begin{array}{l}    
	\displaystyle P = \{ \\
	\displaystyle (1) \:\:\: E \rightarrow T \: E'  \\
	\displaystyle (2) \:\:\: E' \rightarrow + \: T \: E' \\
	\displaystyle (3) \:\:\: E' \rightarrow \epsilon \\
	\displaystyle (4) \:\:\: T \rightarrow F \: T' \\
	\displaystyle (5) \:\:\: T' \rightarrow * \: F\: T' \\
	\displaystyle (6) \:\:\: T' \rightarrow \epsilon \\
	\displaystyle (7) \:\:\: F \rightarrow (\: E \:) \\
	\displaystyle (8) \:\:\: F \rightarrow identificador \\
	\displaystyle (9) \:\:\: F \rightarrow numero \\
	\displaystyle \}
    \end{array} 
     \label{ejsiguiente1}
  \end{equation} 

\begin{enumerate}
\item \$ $\in$ siguiente (E) 

\item E $\rightarrow$ T E' \\
		A $\rightarrow \alpha \: B \beta$ \\
		primero (E') - \{$\epsilon$\} $\subseteq$ siguiente (T) \\
		Como $\epsilon \in$ primero (E') $\Rightarrow$ siguiente (E) $\subseteq$ siguiente (T) \\
		A $\rightarrow \alpha$ B \\
		siguiente (E) $\subseteq$ siguiente (E')
		
\item E' $\rightarrow$ + T E' \\
		A $\rightarrow \alpha \:B \beta$ \\
		siguiente (E') $\subseteq$ siguiente (T)
		
\item T $\rightarrow$ F T' \\
		A $\rightarrow \alpha \:B \beta$ \\
		primero (T') - \{$\epsilon$\} $\subseteq$ siguiente (F) \\
		Como $\epsilon \in$ primero (T) $\Rightarrow$ siguiente (T) $\subseteq$ siguiente (F) \\
		A $\rightarrow \alpha$ B \\
		siguiente (T) $\subseteq$ siguiente (T')
		
\item T' $\rightarrow$ * F T' \\
		A $\rightarrow \alpha \:B \beta$ \\
		siguiente (T') $\subseteq$ siguiente (F)
		
\item F $\rightarrow$ (E) \\
		A $\rightarrow \alpha \:B \beta$ \\
		) $\in$ siguiente (E)


\end{enumerate}

\begin{table}[H]
\begin{center}
 \label{tablaB_4}
 \caption{Conjunto siguiente}

\begin{tabular}[c]{| c | c | }
\hline
  & \textbf{PRIMERO} \\ \hline
 E & \$, ) \\ \hline
 E' & \$, ) \\ \hline
 T & +, \$, ) \\ \hline
 T' & +, \$, ) \\ \hline
 F & *, +, \$, ) \\ \hline
 
\end{tabular}

\end{center}

\end{table}

\section{Construcción de la tabla predictiva}

En esta sección, se procederá a especificar el procedimiento de construcción de la tabla predictiva. El algoritmo para la construcción de la tabla es el que se muestra a continuación:

{\bf\em Construcción de la tabla predictiva}

\newcount\algocount
\begin{algorithm}
{\bf\em inicio} 
\ {\bf\em para cada} A $\rightarrow \alpha \in$ P {\bf\em hacer}  
\ \  {\bf\em si} a $\in$ primero ($\alpha$) {\bf\em entonces} 
\ \ \  A $\rightarrow \alpha \in$ M [A, a] 
\ \  {\bf\em fin si} 
\ \  {\bf\em si} $\epsilon \in$ primero ($\alpha$) {\bf\em entonces} 
\ \ \   {\bf\em para cada} b $\in$ siguiente (A) {\bf\em hacer} 
\ \ \ \  A $\rightarrow \alpha \in$ M [A, b] 
\ \ \   {\bf\em fin para}  
\ \   {\bf\em fin si} 
\  {\bf\em fin para} 
{\bf\em fin}
\end{algorithm}

Una vez construida la tabla predictiva hay que tener en cuenta lo siguiente:

\begin{itemize}
\item Las celdas vací­as de M han de ser tratadas con prodecimientos de control de errores.
\item Las celdas de M con valores múltiples indican que la gramática no admite un análisis descendente predictivo.
\end{itemize}

El formato que debe tener la tabla predictiva, se muestra en la Figura \ref{FiguraB1}.

\begin{figure}
	\begin{center}
         \includegraphics[scale=0.25]{img/tpredictiva.png} 
         \caption{Tabla predictiva}
         \label{FiguraB1}
	\end{center}
  \end{figure}
 \newpage

\textbf{\Large{Ejemplo }}

A continuación se muestra la gramática \ref{predictiva1}, los conjuntos primero y siguiente y por último la tabla predictiva.

\begin{equation}
    \begin{array}{l}    
	\displaystyle P = \{ \\
	\displaystyle (1) \:\:\: S \rightarrow D \: S'  \\
	\displaystyle (2) \:\:\: S' \rightarrow D \: S' \\
	\displaystyle (3) \:\:\: S' \rightarrow \epsilon \\
	\displaystyle (4) \:\:\: D \rightarrow T \: L'\: ;  \\
	\displaystyle (5) \:\:\: T \rightarrow int \\
	\displaystyle (6) \:\:\: T \rightarrow float \\
	\displaystyle (7) \:\:\: L \rightarrow id\: L' \\
	\displaystyle (8) \:\:\: L' \rightarrow id\: L' \\
	\displaystyle (9) \:\:\: L' \rightarrow \epsilon \\
	\displaystyle \}
    \end{array} 
     \label{predictiva1}
  \end{equation} 


\begin{table}[H]
\begin{center}
 \label{tablaB_5}
 \caption{Conjuntos primero y siguiente}

\begin{tabular}[c]{| c | c | c | }
\hline
  & \textbf{PRIMERO} & \textbf{SIGUIENTE} \\ \hline
 S & int, float & \$ \\ \hline
 S' & $\epsilon$, int, float & \$ \\ \hline
 D & int, float & int, float, \$ \\ \hline
 T & int, float & id \\ \hline
 L & id & ;\\ \hline
 L' & ;, $\epsilon$ & ; \\ \hline
 
\end{tabular}

\end{center}

\end{table}


\begin{table}[H]
\begin{center}
 \label{tablaB_6}
 \caption{Tabla predictiva}

\begin{tabular}[c]{| c | c | c | c | c | c | c | }
\hline
 M [A,a] & ; & int & float & id & , & \$ \\ \hline
 S & & 1 & 1 & & & \\ \hline
 S'& & 2 & 2 & & & 3 \\ \hline
 D & & 4 & 4 & & &  \\ \hline
 T & & 5 & 6 & & & \\ \hline
 L & & & & 7 & & \\ \hline
 L'& 9 & & & & 8 & \\ \hline
 
\end{tabular}

\end{center}

\end{table}

