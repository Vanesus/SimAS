%==================================================================================
%   Anexo C: Analisis ascendente
%==================================================================================

\chapter {Análisis Sintáctico Ascendente}

En este anexo se explican los conceptos básicos del Análisis Sintáctico
Ascendente LR. Se recomienda leer primero el 
\textit{Anexo A. Fundamentos teóricos de las gramáticas de contexto libre}
para tomar contacto con los conceptos previos de las gramáticas
de contexto libre.

\section{Introducción}

A continuación se pretende realizar una breve introducción al
análisis sintáctico ascendente por medio de un ejemplo. Nótese
que todos los conceptos que se mencionarán serán explicados con
más detalle a lo largo de este capítulo, tratándose este apartado
de un ejemplo de toma de contacto con el análisis sintáctico ascendente.


El análisis sintáctico ascendente tiene como objetivo el de obtener
una derivación por la \textit{derecha} y en \textit{órden inverso} de la cadena de entrada.
En otras palabras, se pretende 
construir un árbol
sintáctico asociado a la cadena de entrada, de forma tal que dicha 
construcción \textbf{comience} por las \textit{hojas} y \textbf{acabe} por la \textit{raíz}. Es por esto
por lo que se conoce a este análisis como análisis LR, donde
la \textbf{L} (\textit{left}) indica la exploración de izquierda a derecha de la cadena
de entrada y la \textbf{R} (\textit{right}) indica que se construye una derivación
por la derecha a la inversa.

 Para explicar
mejor este concepto, sea la gramática de la expresión \ref{eq:gramaticaAscendente1}:

  \begin{equation}
    \begin{array}{l}    
      \displaystyle P = \{ \\
      \displaystyle (1) \:\:\: S \longrightarrow T \: \mbox{\bf\em id} \: \mbox{\bf\em (} \: L \: \mbox{\bf\em )} \: \mbox{\bf\em a} \: \mbox{\bf\em ;} \\
      \displaystyle (2) \:\:\: T \longrightarrow T \: \mbox{\bf\em *}\\
      \displaystyle (3) \:\:\: T \longrightarrow \mbox{\bf\em int} \\
      \displaystyle (4) \:\:\: L \longrightarrow P \\
      \displaystyle (5) \:\:\: L \longrightarrow \mbox{\bf\em $\epsilon$} \\
      \displaystyle (6) \:\:\: P \longrightarrow P \: \mbox{\bf\em ,} \: T \\
      \displaystyle (7) \:\:\: P \longrightarrow T \\
      \displaystyle  \}
    \end{array} 
    \label{eq:gramaticaAscendente1}
  \end{equation}

Esta gramática genera prototipos de funciones de un lenguaje de programación\footnote{Un ejemplo de prototipo de función 
en C podría ser \textbf{int} * reservarMemoria (\textbf{int});}. Véase la tabla
\ref{tbl:analisisSintactico1} para más información.

  % Tabla 1: Ejemplo de Análisis Ascendente 
  \begin{table}[H]
  %\footnotesize 
  \caption{Ejemplo de análisis Sintáctico Ascendente}
  \vspace{10px}
  \centering
    \begin{tabular}{p{3cm}|p{4cm}|p{5cm}}
      \hline \hline \textbf{Pila} & \textbf{Entrada} & \textbf{Acción} \\
      \hline \underline{\$} & \underline{int} * id ( int ) ; \$ & desplazar \textbf{int} \\
      \$ \underline{int} & \underline{*} id ( int ) ; \$ & reducir $ (3) \: T \longrightarrow int $\\
      \$ \underline{T} & \underline{*} id ( int ) ; \$ & desplazar \textbf{*}\\
      \$ \underline{T *} & \underline{id} ( int ) ; \$ & reducir $ (2) \: T \longrightarrow T * $\\
      \$ \underline{T} & \underline{id} ( int ) ; \$ & desplazar \textbf{id}\\
      \$ T \underline{id} & \underline{(} int ) ; \$ & desplazar \textbf{(}\\
      \$ T id \underline{(} & \underline{int } ) ; \$ & desplazar \textbf{int}\\
      \$ T id (\underline{int} & \underline{)} ; \$ & reducir $ (3) \: T \longrightarrow int$\\
      \$ T id (\underline{T} & \underline{)} ; \$ & reducir $ (7) \: P \longrightarrow T$\\
      \$ T id (\underline{P} & \underline{)} ; \$ & reducir $ (4) \: L \longrightarrow P$\\
      \$ T id (\underline{L} & \underline{)}; \$ & desplazar \textbf{)}\\
      \$ T id (L\underline{)} & \underline{;} \$ & desplazar \textbf{;}\\
      \$ \underline{T id (L) ;} & \underline{\$} & reducir $ (1) \: S \longrightarrow T id (L);$\\
      \$ \underline{S} & \underline{\$} & \color{blue}\textbf{ACEPTAR}\\

      \hline
    \end{tabular}
  \label{tbl:analisisSintactico1}
  \end{table}

  Tal y como se muestra en el ejemplo, la entrada int * id (int); es reconocida, puesto
que es una declaración de función en C y es generada por la gramática. El árbol de derivación
que se obtiene es el que se muestra en la figura \ref{fig:figura3_1_arbolDerivacion}.

  \begin{figure}[H]
    \begin{center} 
      \includegraphics[width=0.6\textwidth]{img/figura3_1arbolDerivacion.jpg}
      \caption{Árbol de derivación de la gramática anterior}
      \label{fig:figura3_1_arbolDerivacion}
    \end{center}
  \end{figure}

  La derivación correspondiente a dicho análisis sería la siguiente:

  \begin{equation}
    \begin{array}{l} 
	\displaystyle S \: \: \Dflecha_{1} \: \: T \: \mbox{\bf\em id} \: \mbox{\bf\em (} \: \underline{L} \: \mbox{\bf\em )} \: \mbox{\bf\em ;} \: \: \Dflecha_{4} \: \: T \: \mbox{\bf\em id} \: \mbox{\bf\em (} \: \underline{P} \: \mbox{\bf\em )} \: \mbox{\bf\em ;} \: \: \Dflecha_{7} \: T \: \mbox{\bf\em id} \: \mbox{\bf\em (} \: \underline{T} \: \mbox{\bf\em )} \: \mbox{\bf\em ;}\\ \\
			\: \: \: \: \: \: \Dflecha_{3} \: \: \underline{T} \: id \: \mbox{\bf\em (}\: \mbox{\bf\em int} \:\mbox{\bf\em )} \: \mbox{\bf\em ;} \: \: \Dflecha_{2} \: \: \underline{T} \: \mbox{\bf\em *} \: \mbox{\bf\em id} \: \mbox{\bf\em (}\: \mbox{\bf\em int} \: \mbox{\bf\em )}\: \mbox{\bf\em ;} \: \: \Dflecha_{3} \: \textbf{int * id ( int );}
    \end{array} 
    \label{eq:derivacion11111}
  \end{equation}

  Como se observa, en el análisis sintáctico ascendente se realiza la derivación tomando siempre el símbolo
no terminal \textbf{más a la derecha} de la cadena de entrada. Así, se va obteniendo una derivación
en \textbf{orden inverso}.

  En el análisis realizado en la figura \ref{fig:figura3_1_arbolDerivacion} se han llevado a cabo
tres operaciones, que son: \textbf{desplazar}, \textbf{reducir} y \textbf{aceptar}. Las acciones que se llevan a cabo
durante el análisis sintáctico ascendente son las siguientes:

\begin{itemize}
 \item \textbf{Desplazar}: consiste en desplazar un símbolo de la cadena
de entrada a la pila de símbolos.
 \item \textbf{Reducir}: se reduce el contenido de la pila (el que se muestra
subrayado en el ejemplo) con alguna de las reglas de producción
de la gramática.
 \item \textbf{Aceptar}: se acepta la cadena de entrada.
 \item \textbf{Error}: si se aplican funciones de tratamiento de error
o la cadena de entrada no es aceptada.
\end{itemize}

\section{Concepto de pivote}

Si $ G \: = \: (V_{N}, V_{T}, P, S)$ es una gramática de contexto libre
y se tiene que:

  \begin{equation}
    \begin{aligned}
      S \: \: \Dflecha_{D}^{K} \: \: \gamma
    \end{aligned}
   \end{equation}


Entonces un pivote se define como:

\begin{itemize}
 \item Una regla de producción de la forma $ A \rightarrow \beta $.
 \item Una posición en $ \gamma $, en la cual se encuentra $ \beta $.
\end{itemize}

De esta forma, se tiene que al sustituir $ \beta $ por A en $ \gamma $,
se obtiene el \textit{paso anterior} de una \textbf{derivación por la derecha}.
Así, si $\gamma \: \: = \alpha \: \textcolor{blue}{\beta} \: \textcolor{brown}{z} $ se
entonces:

  \begin{equation}
     S \: \: \Dflecha_{D}^{*} \: \: \alpha \textcolor{blue}{A} \textcolor{brown}{z} \: \: \Dflecha_{\textcolor{blue}{A \: \rightarrow \: \beta}} \:\: \alpha \textcolor{blue}{\beta} \textcolor{brown}{z} \: \: = \: \: \gamma
  \end{equation}

  \begin{table}[H]
  %\footnotesize
  \caption{Ejemplo de un pivote}
  \vspace{10px} 
  \centering
    \begin{tabular}{p{2cm}|p{3cm}|p{4cm}}
      \hline \hline \textbf{Pila}         & \textbf{Entrada}         & \textbf{Acción} \\
      \hline 
      $\ldots$ 			          & $\ldots$ 		     & $\ldots$ \\
      $\alpha$ \textcolor{blue}{$\beta$}  & \textcolor{brown}{z} \$  & \textcolor{verde-oscuro}{reducir} $ \textcolor{blue}{A \longrightarrow \beta}$\\
      $\alpha$ \textcolor{blue}{$A$}      & \textcolor{brown}{z} \$  & $\ldots$ \\
      $\ldots$ 			          & $\ldots$ 		     & $\ldots$ \\
      \hline
    \end{tabular}
    \label{tbl:pivote}
  \end{table}

El pivote siempre se va a encontrar en la cima de la pila. Cuando se detecte, se realizará la reducción correspondiente.
Nunca se va a encontrar un pivote en el "interior" de la pila, porque, en ese caso, no se produciría una derivación por la derecha en orden inverso.


\section{Conflictos}

Existen gramáticas de contexto libre para las cuales no es aplicable
el análisis sintáctico de ascendente, también llamado de desplazamiento-
reducción, por lo comentado anteriormente [1].

Es posible que se produzcan situaciones en las que el analizador
sintáctico, dada una cierta configuración de la pila y el siguiente
símbolo de la entrada a ser procesado, no puede decidir si se
va a realizar un \textbf{desplazamiento} o una \textbf{reducción}.
En estos casos se produce lo que se conoce como un \textbf{conflicto}.
Dicho conflicto podrá ser de alguno de los siguientes tipos:

\begin{itemize}
 \item \textbf{Conflicto de desplazamiento-reducción}: este conflicto se 
  produce cuando hay dos posibles acciones: \textbf{desplazar} un símbolo de
  la entrada a la pila o \textbf{reducir} con una regla de producción. Estos
  conflictos, que suelen ser muy frecuentes, se suelen resolver 
  desarrollándose la opción del desplazamiento.

 \item {\textbf{Conflicto de reducción-reducción}: este conflicto se produce
  cuando se tiene una situación como la siguiente:

  \begin{equation}
    \begin{array}{l}  
      A \: \: \longrightarrow \: \: \beta \: \: \in \: \: P \\
      B \: \: \longrightarrow \: \: \beta \: \: \in \: \: P      
    \end{array} 
  \end{equation}

  En este caso, el analizador no sabe que regla debe aplicar, por
  lo que se llega a un conflicto crítico que detendría el análisis
  y recurriría a funciones de tratamiento de error. 

  Por lo general, este tipo de conflictos se debe al uso de gramáticas
  ambigüas, por lo que se podría evitar creando gramáticas que estén
  libres de ambigüedad.
  }
  
\end{itemize}

Para ilustrar mejor estos conceptos, supóngase la siguiente gramática
de contexto libre, que genera expresiones aritméticas:

  \begin{equation}
    \begin{array}{l}    
      \displaystyle P = \{ \\
      \displaystyle (1) \:\:\: E \longrightarrow E \: \mbox{\bf\em +} \: E \: \mbox{\bf\em ;} \\
      \displaystyle (2) \:\:\: E \longrightarrow E \: \mbox{\bf\em *} \: E\\
      \displaystyle (3) \:\:\: E \longrightarrow \mbox{\bf\em (} \: E \: \mbox{\bf\em )} \\
      \displaystyle (4) \:\:\: E \longrightarrow \mbox{\bf\em id} \\
      \displaystyle (5) \:\:\: E \longrightarrow \mbox{\bf\em número} \\
      \displaystyle  \}
    \end{array} 
    \label{eq:gramaticaAscendente2}
  \end{equation}

Si se realiza un análisis ascendente de la cadena de entrada
$ \mbox{\bf\em id} + \mbox{\bf\em id} * \mbox{\bf\em id}$, se tiene lo siguiente:

  % Tabla 2: Conflictos 1
  \begin{table}[H]
  %\footnotesize 
  \caption{Análisis con conflictos desplazamiento-reducción}
  \vspace{10px}
  \centering
      \begin{tabular}{p{3cm}|p{4cm}|p{5cm}}
	\hline \hline \textbf{Pila} & \textbf{Entrada} & \textbf{Acción} \\
	\hline \underline{\$} & \underline{id} + id * id \$ & desplazar \textbf{id} \\
	\$ \underline{id} & \underline{+} id * id \$ & reducir $ (4) \: E \longrightarrow id $\\
	\$ \underline{E} & \underline{+} id * id \$ & desplazar \textbf{+}\\
	\$ E \underline{+} & \underline{id} * id \$ & desplazar \textbf{id}\\
	\$ E + \underline{id} & \underline{*} id \$ & reducir $ (4) \: E \longrightarrow id $\\
	\$ E + \underline{E} & \underline{*} id \$ & \color{red}\textbf{desplazar *} \newline \color{red}\textbf{reducir} $ (1) \: E \longrightarrow E + E $\\
	\hline
      \end{tabular}
  \label{tbl:analisisConflictos1}
  \end{table}

Como se observa, al final se tiene un conflicto, puesto que se puede
des\-pla\-zar el token '*' a la pila o se puede reducir con la regla 1.
Para ilustrar el ejemplo mejor, supóngase que se realiza la reducción,
continuando el análisis como se muestra en la tabla \ref{tbl:analisisConflictos2}.

  % Tabla 3: Conflictos 2
  \begin{table}[H]
  %\footnotesize
  \caption{Análisis con conflictos desplazamiento-reducción (continuación)}
  \vspace{10px} 
  \centering
    \begin{tabular}{p{3cm}|p{4cm}|p{5cm}}
      \hline \hline \textbf{Pila} & \textbf{Entrada} & \textbf{Acción} \\
      \hline \$ \underline{E} & \underline{*} id \$ & desplazar \textbf{*} \\
      \$ E \underline{*} & \underline{id} \$ & desplazar \textbf{id} \\
      \$ E * \underline{id} & \underline{\$} & reducir $ (4) \: E \longrightarrow id $\\
      \$ E * \underline{E} & \underline{\$} & reducir $ (2) \: E \longrightarrow E \: * \: E $\\
      \$ \underline{E} & \underline{\$} & \color{blue}\textbf{ACEPTAR}\\
      \hline
    \end{tabular}
  \label{tbl:analisisConflictos2}
  \end{table}

Según este análisis (no se debe olvidar que se realizó la 
reducción cuando se produjo el conflicto), se tiene el 
siguiente árbol de derivación:

  \begin{figure}[H]
    \begin{center} 
      \includegraphics[width=0.2\textwidth]{img/figura3_2_arbolDerivacion2.jpg}
      \caption{Conflictos: árbol de derivación si se desplaza.}
      \label{fig:figura3_2_arbolDerivacion2}
    \end{center}
  \end{figure}

Como se observa, aunque el análisis sintáctico terminó satisfactoriamente,
el análisis semántico posterior no sería correcto, debido a que el 
operador '+' se ha asignado a los dos primeros identificadores,
lo cual no es correcto. Por otro lado, si se hubiera hecho el
desplazamiento (en el caso anterior), se tendría el siguiente árbol
de derivación:

  \begin{figure}[H]
    \begin{center} 
      \includegraphics[width=0.2\textwidth]{img/figura3_3arbolDerivacion3.jpg}
      \caption{Conflictos: árbol de derivación si se reduce.}
      \label{fig:figura3_3_arbolDerivacion3}
    \end{center}
  \end{figure}

Existen muchos más ejemplos que ilustran estos confictos, como son los problemas
del \textit{else danzante} o \textit{colgante} [1].

Una vez realizada una introducción al análisis ascendente en general,
se explicarán cada uno de los métodos LR en las siguientes secciones
(recuérdese que éstos ya fueron presentados en el capítulo 1). Los métodos
de análisis con reglas de precedencia [4], quedarán
fuera de este ámbito, puesto que SimLR sólo simulará los métodos
de análisis LR.

\section{Gramáticas LR}

Para poder comprender los métodos de análisis LR habría que
realizar ciertas anotaciones sobre los conceptos de gramáticas
de contexto libre (presentados en el \textit{Apéndice A. 
Fundamentos teóricos de las gramáticas de contexto libre}).

Supóngase una gramática de contexto libre G. Esta gramática
sería una gramática LR si se verifican las siguientes condiciones:

\begin{enumerate}
 \item {Se amplía G de forma que el símbolo inicial no esté en la
parte derecha de ninguna regla de producción. 
Este proceso se detalla en la expresión \ref{eq:propiedadLR1}.

  \begin{equation}
    \begin{array}{l}  
	  G' \: = \: (V_{N}', V_{T}', P', \textcolor{blue}{S'}) \\
	  \textcolor{blue}{S'} \in V_{N}' - V_{N} \\
	  V_{N}' = V_{N} \cup \{S'\} \\
	  P' = P \cup \{\textcolor{blue}{S'} \longrightarrow S\}
    \end{array}
    \label{eq:propiedadLR1}
  \end{equation}
 }
 \item {Si existen \textbf{dos derivaciones} por la \textbf{derecha} con la siguiente forma:
    \begin{equation}
    \begin{array}{l}  
	 S' \: \: \Dflecha_{D}^{*} \: \:   \alpha \underline{A} w \Dflecha_{A \rightarrow \beta} \alpha \textcolor{blue}{\beta} w \\
         \\
	 S' \: \: \Dflecha_{D}^{*} \: \:   \gamma \underline{B} x \Dflecha_{B \rightarrow \beta} \alpha \textcolor{blue}{\beta} y \\
    \end{array}
    \label{eq:propiedadLR2}
  \end{equation}
 }

 \item {Los primeros \textbf{k} símbolos de \textbf{w} y \textbf{x} son iguales.

    \begin{equation}
    \begin{array}{l}  
	  w = \textcolor{blue}{\sigma_{i1}\dots\sigma_{ik}}\gamma_{1}\dots\gamma_{p} \\
	  y = \textcolor{blue}{\sigma_{i1}\dots\sigma_{ik}}\eta_{1}'\dots\eta_{q}' \\
    \end{array}
    \label{eq:propiedadLR3}
  \end{equation}
 }
\end{enumerate}

Si se cumplen las tres condiciones anteriores, se
verifica que $ \alpha A y = \gamma B x $. Es decir,
se tiene que:

    \begin{equation}
    \begin{array}{lllll}  
       \alpha & = & \gamma \\
       A      & = & B \\
       x      & = & y
    \end{array}
    \label{eq:propiedadLR4}
  \end{equation}


Resulta complicado poder controlar estas tres condiciones
para cada entrada y en cada iteración del algoritmo, puesto
que no se pueden controlar todas las derivaciones. Por tanto,
lo que se hace es construir una tabla LR (tabla de análisis LR),
que será introducida en la siguiente sección.

\section{Tabla de análisis LR}

La tabla de análisis LR permitirá controlar todas las condiciones
anteriores para así determinar si se puede realizar el análisis
LR a una determinada gramática de contexto libre (dados un símbolo
de entrada y los símbolos de la pila, como en los ejemplos
anteriores). Estas tablas se componen de las siguientes partes:

\begin{itemize}
 \item \textbf{Parte acción}: contiene todos los símbolos terminales, incluyendo
  el \textbf{$\$$} (final de cadena).
 \item \textbf{Parte Ir-a}: indica las transiciones entre estados (esta parte
  es similar a la del \textit{análisis descendente}). Esta parte
  solamente se consulta cuando se realiza una reducción.
\end{itemize}

En cada una de las celdas de la parte acción se podrán llevar a cabo las
siguientes acciones:

\begin{itemize}
 \item \textbf{Desplazar (d)}: consiste en un desplazamiento de un símbolo
 de la cadena de entrada a la cima de la pila. Por ejemplo, \textbf{d4}
 indica que se desplaza el símbolo actual y se pasa al estado 4.

 \item \textbf{Reducir (r)}: es una reducción con una regla de la gramática.
  Por ejemplo, \textbf{r4} indicaría que se reduce con la regla 4 de la gramática. 
  Después, se deberá mirar la parte Ir-a, para determinar el 
  estado al que se pasa (esto se explicará con más detalle
  en las secciones posteriores).

 \item \textbf{Error (e)}: se realiza una llamada a una función de error.
  Generalmente, las celdas vacías de la parte acción se rellenan 
  con funciones de error, puesto que si dichas celdas son consultadas
  durante el análisis, significa que ha habido un error y que debe
  de ser tratado. Por ejemplo, \textbf{e1} llamaría a la función de error 1,
  para tratar un determinado error (esto se detallará más adelante, según
  cada tipo de análisis).

  \item \textbf{Aceptar}: se acepta la cadena de entrada. Esta acción puede
  aparecer en \textbf{cualquier fila} de la tabla LR dentro de la parte acción, pero
  siempre aparece en la \textbf{columna} del símbolo \textbf{$\$$} (final de cadena), indicando
  que es el final del análisis.
\end{itemize}


Por su parte, las celdas de la tabla Ir-a indican transiciones
entre los distintos estados del análisis (se detallará más adelante).
Las celdas vacías de esta parte \textbf{nunca} se consultarán.

  % Ejemplo de tabla LR
  \begin{table}[!h]
  %\footnotesize
  \caption{Ejemplo de tabla de Análisis LR}
  \vspace{10px} 
  \centering
  \begin{small} 
    \begin{tabular}{| c | p{0.4cm} | p{0.4cm} | p{0.4cm} | p{0.4cm} | p{0.4cm} | p{0.4cm} | p{0.4cm}  | c | c | c | c |}
      \hline \hline
      & \multicolumn{5}{c|}{\textcolor{blue}{\textbf{Acción}}} & \multicolumn{4}{c|}{\textcolor{blue}{\textbf{Ir-a}}} \\
      \hline \textbf{Estado} & \textbf{;} & \textbf{int} & \textbf{id} & \textbf{,} & \textbf{\$} & \textbf{S} & \textbf{D} & \textbf{T} & \textbf{L} \\ 
      \hline 0 & & \textcolor{blue}{\textbf{d4}} & & & & 1 & 2 & 3 & \\
      \hline 1 & & \textcolor{blue}{\textbf{d4}} & & & \textcolor{verdeOscuro}{\textbf{Aceptar}} & & 5 & 3 & \\
      \hline 2 & & & & & \textcolor{magenta}{\textbf{r2}} & & & & \\
      \hline 3 & & & \textcolor{blue}{\textbf{d7}} & & & & & & 6 \\
      \hline 4 & & & \textcolor{magenta}{\textbf{r4}} & & & & & & \\ 
      \hline 5 & & & & & \textcolor{magenta}{\textbf{r1}} & & & & \\
      \hline 6 & \textcolor{blue}{\textbf{d8}} & & & \textcolor{blue}{\textbf{d9}} & & & & & \\ 
      \hline 7 & \textcolor{magenta}{\textbf{r5}} & & & \textcolor{magenta}{\textbf{r5}} & & & & & \\ 
      \hline 8 & & & & & \textcolor{magenta}{\textbf{r3}} & & & & \\
      \hline 9 & & & \textcolor{blue}{\textbf{d10}} & & & & & & \\
      \hline 10 & \textcolor{magenta}{\textbf{r6}} & & & \textcolor{magenta}{\textbf{r6}} & & & & & \\ 
      \hline
    \end{tabular}
 \end{small}
  \label{tbl:tablaLR}
  \end{table}


La gramática utilizada para la generación de esta tabla es la que se 
muestra en la expresión \ref{eq:gram1111}.

   \begin{equation}
    \begin{array}{l}    
	\displaystyle P = \{ \\
	\displaystyle (1) \:\:\: S' \rightarrow S \\
	\displaystyle (2) \:\:\: S \rightarrow S \: D \\
	\displaystyle (3) \:\:\: S \rightarrow D \\
	\displaystyle (4) \:\:\: D \rightarrow T \: L \: ; \\
	\displaystyle (5) \:\:\: T \rightarrow \mbox{\bf\em int} \\
	\displaystyle (6) \:\:\: L \rightarrow \mbox{\bf\em id} \\
	\displaystyle (7) \:\:\: L \rightarrow L \: , \: \mbox{\bf\em id} \\
	\displaystyle \}
    \end{array} 
    \label{eq:gram1111}
  \end{equation}  

\section{Mecanismos de Análisis Ascendente LR}

Como se comentó en el \textit{Capítulo 1. Introducción}, existen dos tipos de mecanismos
de análisis ascendente: los métodos basados en reglas de precedencia
y los métodos \textbf{LR}. A continuación se detallará el funcionamiento
de cada uno de estos métodos \textbf{LR}, que serán utilizados en este
proyecto.

\subsection{Método SLR: Simple LR}

Este método es el más sencillo (aunque el menos potente) para construir un analizador
sintáctico ascendente 
basado en desplazamiento-reducción.
En este caso, se conoce como mecanismo \textit{LR simple}, o
\textbf{SLR}. A continuación se explicará en detalle este mecanismo.

\subsubsection{LR(0)-elementos}

La colección de elementos \textbf{LR(0)} se utiliza en este mecanismo
para que el análisis sepa cuándo tiene que
realizar una \textbf{reducción} o un \textbf{desplazamiento} (véase el apartado
B.1 del apéndice B). Es por esto por lo que el analizador
utiliza un conjunto de estados para ir controlando el flujo
del análisis.

Cada uno de estos estados es representado como un conjunto
de elementos llamados conjunto de elementos LR(0). 
Se define un elemento \textbf{LR(0)} como una producción de la 
gramática que posee un punto (·) en cualquier posición
de la parte derecha. Así, este punto indica la parte de la
producción que ya ha sido analizada durante el análisis.

Imagínese que se tiene una regla de producción de una gramática
\textbf{G} de la forma $A \rightarrow X_{1}X_{2} \dots X_{n-1}X_{n} \in P$.
A partir de esta regla, se obtendrían los siguientes elementos
LR(0):

  \begin{equation}
    \begin{array}{llll}   
        A & \rightarrow & \cdot X_{1} X_{2} ... X_{n-1} X_{n} \\
        A & \rightarrow & X_{1} \cdot X_{2} ... X_{n-1} X_{n} \\
        A & \rightarrow & X_{1} X_{2} ... \cdot X_{n-1} X_{n} \\
        A & \rightarrow & X_{1} X_{2} ... X_{n-1} \cdot X_{n} \\
    \end{array} 
    \label{eq:derivacion1111}
  \end{equation}

Como regla general, se puede afirmar que se tienen tantos
elementos LR(0) como símbolos haya en la parte derecha
de la regla \textit{más uno}.

Cuando se tiene el elemento
$A \rightarrow X_{1} \dots X_{n} \cdot$, el
analizador realiza una reducción. Además, cabe destacar la
excepción de que una regla de producción de la forma
$ A \rightarrow \epsilon $ produciría un elemento
LR(0) de la forma $ A \rightarrow \cdot$.

\subsubsection{Prefijos viables}

Un prefijo viable se define como:

  \begin{equation}
    \label{eq:prefijoViable}
    % \; espacio grande
    % \: espacio mediano (tirando a pequeño para mi gusto)
    \begin{array}{ll}
      \delta \in  V^{*}  =  (V_{N} \cup V_{T})^{*}
    \end{array}
   \end{equation}

Donde $V^{*}$ simboliza a una cadena de símbolos gramaticales. Así,
$\delta$ es un prefijo viable si se verifica que:

\begin{enumerate}
 \item {Aparece en una derivación por la derecha que genera una cadena
  de símbolos terminales. Nótese que en el prefijo viable también
  pueden entrar símbolos terminales.

  \begin{equation}
    \label{eq:prefijoViable1}
    % \; espacio grande
    % \: espacio mediano (tirando a pequeño para mi gusto)
    \begin{array} {ll} 
      S \: \Dflecha_{D}^{*} \: \delta\gamma \: \Dflecha^{*} x \in V_{T}
    \end{array}
   \end{equation}  
  }

  \item {El Elemento LR(0) $A \rightarrow \beta_{1} \cdot \beta_{2}$ es válido
  para un prefijo viable $\delta = x \beta_{1}$ si se verifica que:
    
    \begin{equation}
      \label{eq:prefijoViable2}
      % \; espacio grande
      % \: espacio mediano (tirando a pequeño para mi gusto)
      \begin{array} {ll} 
	S' \: \Dflecha_{D}^{*} \: \alpha A \omega \Dflecha \alpha \underbrace{\beta_{1} \beta_{2}}_{A \rightarrow \beta_{1} \beta_{2}} \omega
      \end{array}
    \end{equation}  

  Así se tendrían varios casos, según el valor que tomara $\beta_{2}$.
  En el primero de ellos ($\beta_{2} = \epsilon$) se tendría lo mostrado
  en la tabla \ref{tbl:prefijoViable1}

  \begin{table}[H]
  %\footnotesize 
  \caption{Caso 1: Elemento LR(0) válido de un prefijo viable cuando $\beta_{2} = \epsilon$.}
  \vspace{10px}
  \centering
    \begin{tabular}{p{3cm}|p{4cm}|p{5cm}}
      \hline \hline \textbf{Pila} & \textbf{Entrada} & \textbf{Acción} \\
      \hline $\alpha$ \underline{$\beta_{1}$} & \underline{w} \$ & reducir $ A \longrightarrow \beta_{1}$ \\
      $\alpha$ \underline{A} & \underline{w} \$ & \\
      \hline
    \end{tabular}
  \label{tbl:prefijoViable1}
  \end{table}

  Por otro lado, podría ocurrir que $\beta_{2} \neq \epsilon$, en cuyo
  caso se obtendría lo que se muestra en la tabla \ref{tbl:prefijoViable2}

  \begin{table}[H]
  %\footnotesize 
  \caption{Caso 2: Elemento LR(0) válido de un prefijo viable cuando $\beta_{2} \neq \epsilon$.}
  \vspace{10px}
  \centering
    \begin{tabular}{p{3cm}|p{4cm}|p{5cm}}
      \hline \hline \textbf{Pila} & \textbf{Entrada} & \textbf{Acción} \\
      \hline \dots & \dots & \dots \\
      $\alpha$ \underline{$\beta_{1}$} & \underline{x}w \$ & \dots \\
      \dots & \dots & \dots \\
      $\alpha \beta_{1}$\underline{$\beta_{2}$} & \underline{w} \$ & reducir $ A \longrightarrow \beta_{1}\beta_{2} $\\
      $\alpha$\underline{A} & \underline{w} & \dots \\
      \hline
    \end{tabular}
  \label{tbl:prefijoViable2}
  \end{table}
  }
\end{enumerate}

\subsubsection{Colección canónica de LR(0)-elementos}

La colección canónica de \textbf{LR(0)-elementos} permitirá construir un
autómata finito determinista (\textbf{AFD}), para así poder realizar un
análisis sintáctico ascendente \textbf{SLR}. Para su construcción,
se seguirán los siguientes pasos:

\begin{enumerate}
 \item {\textbf{Función clausura}: supóngase I como un conjunto
  de elementos LR(0). La clausura de I se define como:
  \begin{enumerate}
    \item Todo conjunto está contenido en su clausura. $ I \subseteq clausura(I)$.
    \item Si $ A \rightarrow \alpha \cdot B \beta \in clausura(I)$ entonces
    se tiene que $ B \rightarrow \cdot \gamma \in clausura(I) $, para
    cualquier $ B \rightarrow \gamma \in P$.
  \end{enumerate}  
 }

 \item {\textbf{Función Ir\_a}: esta función se define como el conjunto
  de elementos LR(0) $ \alpha $ al que se realiza una transición
  desde el conjunto original \textbf{I}, a partir de un símbolo terminal.
  Esta función servirá para crear las transiciones del \textbf{AFD}.
  Sea el siguiente ejemplo:

    \begin{equation}
      \label{eq:ir_a}
      \begin{array} {ll} 
	Ir\_a(I, x) = \{A \rightarrow \alpha x \cdot \beta \: | \: A \rightarrow \alpha \cdot x \beta \in I\} \\
	x \in V = V_{N} \cup V_{T} \\
      \end{array}
    \end{equation} 

  Esta función se realiza para un conjunto de elementos LR(0)
  hasta que el punto ($ \cdot $) alcanza el final de todas las
  producciones. En este caso, se habrían analizado todas y 
  cada una de las producciones del conjunto.
 }

\end{enumerate}

\subsubsection{Algoritmo de construcción de la tabla SLR}

A continuación se procederá a especificar el procedimiento
de construcción de la tabla de análisis SLR. El algoritmo
para la construcción de la tabla es el que se muestra
 a continuación:

{\bf\em Construcción de la colección canónica de LR(0)-elementos}
\newcount\algocount
\begin{algorithm}
{\bf\em inicio} 
\ $I_{0} \leftarrow clausura({S' \rightarrow S}) $ 
\ $C \leftarrow {I_{0}} \wedge {I_{0}} $ no marcado 
\ {\bf\em para} cada $I \in C \wedge I $ no marcado {\bf\em hacer} 
\ \ marcar I 
\ \ {\bf\em para} cada $X \in V $ {\bf\em hacer} 
\ \ \ $I' \leftarrow Ir\_a(I, X) $ 
\ \ \ {\bf\em si} $I' \notin C $ 
\ \ \ \ {\bf\em entonces} $C \leftarrow C \cup {I'} \wedge I'$ no marcado 
\ \ \ {\bf\em fin si}  
\ \ {\bf\em fin para} 
\ {\bf\em fin para} 
{\bf\em fin}
\end{algorithm}


El proceso de construcción de la tabla es el siguiente:

\begin{enumerate}
 \item \textbf{Ampliar la gramática} con la regla de producción $ S' \rightarrow S $.
  Así, al crear un nuevo símbolo inicial (S') se consigue que el
  símbolo inicial de la gramática no aparezca nunca en la parte
  derecha de una regla.

 \item \textbf{Construir la colección canónica de LR(0)-elementos}. Siempre
  se comienza realizando la clausura de la producción que tenga
  el símbolo inicial de la gramática (ahora S') a la izquierda.
  Así, se comenzaría con $ I_{0} = clausura (\{[S' \rightarrow S\}) $. Se
  continuaría construyendo la colección canónica hasta que
  se hubieran analizado todas las producciones. Cada uno de
  los elementos $ I_{i} $ serán usados para crear el \textbf{AFD}.

 \item \textbf{Generar el autómata que reconoce los prefijos viables}. Cada
  elemento $ I_{i} $ calculado en la colección canónica se corresponderá con
  un estado del autómata.

 \item {\textbf{Rellenar las partes acción e Ir-a de la tabla SLR}.
  Para rellenar cada una de estas partes de la tabla de análisis,
  se procederá de la siguiente forma:

    \begin{enumerate}
      \item {Si $ A \rightarrow  \alpha \cdot \sigma \beta \in I_{i}$, siendo
      $ \beta $ un símbolo terminal y cumpliéndose que
      $ Ir\_a (I_{i}, \sigma) = I_{j} $, entonces se tiene que
      $ accion [i, \sigma] = d_{j} $, lo cual significa \textbf{desplazar}
      de la entrada a la pila el símbolo $ \sigma $ y pasar al estado \textbf{j} (transición a j).
      }
      \item {Si $ A \rightarrow \alpha \cdot \in I_{i} $ entonces
      se tiene una reducción (puesto que el punto está al final de la
      producción). Así, se tendrá que $ accion [i, \sigma] = r_{k} $.
      En esta reducción se debe cumplir lo siguiente:

	  \begin{enumerate}
	    \item El símbolo $\sigma$ está contenido en siguiente(A).
	    \item El subíndice k indica la regla $ A \rightarrow \alpha \in P$,
	      donde k viene a representar el número de la producción
	      con la que se reduce.
	  \end{enumerate}
      
      }
     \item {Si $ S' \rightarrow S \cdot \in I_{i}$, entonces
      se ha terminado el análisis y se tiene que 
      $ accion [i, \$] = ACEPTAR$. 
     }

      Si hubiera alguna entrada
      de la parte acción \textbf{repetida}, la gramática no admitiría
      un análisis SLR. Suponiendo que no se producen conflictos,
      pásese al paso 5.
    \end{enumerate}
  }

  \item Ahora se \textbf{completa la parte Ir-a} de la tabla SLR. Para
  ello, se hace lo siguiente:

    \begin{equation}
      \label{eq:tabla_slr_1}
      \begin{array} {ll} 
	\forall A \in V_{N} \: \: si\:  \: Ir\_a(I_{i}, A) = I_{j} \\
	    entonces \: \: Ir\_a[i, A] = j
      \end{array}
    \end{equation}     

  \item Las \textit{celdas vacías} de la parte acción \textit{contienen errores}.
   Por su parte, las celdas vacías de la parte Ir-a nunca
   serán consultadas (y por tanto, no ocasionarán error alguno).
\end{enumerate}

\subsubsection{Conflictos en el análisis SLR}

En el análisis \textbf{SLR} se pueden presentar dos tipos de conflicto:

\begin{itemize}
 \item \textbf{Desplazamiento-reducción}: se presenta cuando se tienen
  las opciones de \textbf{reducir} y \textbf{desplazar} disponibles a la vez
  (esto es accion [i, $\beta$] = $r_{k}$ y accion [i, $\beta$] = $dj$).
  La opción por defecto suele ser realizar el desplazamiento.

 \item \textbf{Reducción-reducción}: este conflicto, el cual es mucho más grave,
  se produce cuando hay dos reducciones posibles para aplicar. En
  este caso, el autómata no podría realizar el análisis. En otras
  palabras, la gramática no admite un análisis SLR si se produce
  este tipo de conflicto. Para evitar su aparición, es preciso
  crear una buena gramática y revisarla concienzudamente\footnote{Esto se debe a que no existe ningún algoritmo que permita comprobar la ocurrencia
  de este conflicto. Solo la experiencia del diseñador podrá servir de ayuda en este aspecto}.
\end{itemize}

\subsubsection{Ejemplo de análisis SLR}

En el \textit{Apéndice C. Ejemplos de los métodos de análisis ascendente LR}
se muestra un ejemplo del \textbf{método SLR}.

\subsection{Método LR-canónico}

Este método de análisis es el más complejo de los tres
métodos LR, pero es el más potente. Como contrapartida,
la construcción de la colección canónica es, en este
caso, más tediosa y compleja. 

\subsubsection{LR(1)-elementos}

Los elementos \textbf{LR(1)} servirán, como en el caso del análisis
\textbf{SLR}, para construir la tabla de análisis (tal y como se vio
en las secciones anteriores). Así, se define un elemento
\textbf{LR(1)} como: 

\begin{enumerate}
 \item Una regla de la gramática que tiene un \textit{punto} ($\cdot$) en el interior.
 \item Un \textit{símbolo de anticipación}.
\end{enumerate}

Así se tiene el siguiente ejemplo:

    \begin{equation}
      \label{eq:LR1-elementos}
      \begin{array} {ll} 
        [\underbrace{A \rightarrow \beta_{1} \cdot \beta_{2}}_{(1)}, \underbrace{\sigma}_{(2)}]
      \end{array}
    \end{equation}  

Donde a (1) se le conoce como \textit{centro} o \textit{corazón}, 
mientras que a (2) se le conoce como símbolo de \textbf{anticipación}\footnote{Esto en la literatura se conoce como \textit{Look Ahead Symbol}.} y
siempre se verifica que $ \sigma \in siguiente(A) $.

Por cuestiones de notación, podrían aparecer varios elementos
\textbf{agrupados} \textit{siempre y cuando posean el mismo corazón}.
Así se tendría lo siguiente:

    \begin{equation}
      \label{eq:LR1-elementos11}
      \begin{array} {ccccc} 
        & [A \rightarrow \beta_{1} \cdot \beta_{2}, \sigma_{1}] \\
        & [A \rightarrow \beta_{1} \cdot \beta_{2}, \sigma_{2}] \\
	& \Downarrow \\
	& [A \rightarrow \beta_{1} \cdot \beta_{2}, \sigma_{1}, \sigma_{2}]
      \end{array}
    \end{equation}  

Nótese que esta agrupación implica dos hechos:
en primer lugar, indica que la regla se puede obtener
de dos formas diferentes; en segundo lugar, justifica 
la existencia de los dos elementos por separado. 
Es preciso anotar que durante los ejemplos
que se muestran en este documento se utilizará tal simplificación. Aún
así, se debe tener en mente que en el caso anterior siempre se 
suponen los dos elementos por separado (aunque se hayan mostrado
agrupados, con ánimo de simplificar).

\subsubsection{Prefijos viables}

Ya se explicó anteriormente el concepto de \textit{prefijo viable},
en el análisis \textbf{SLR}. A partir de esta definición
(véanse las expresiones \ref{eq:prefijoViable1} y \ref{eq:prefijoViable2}),
se calculará el elemento LR(1) válido para un prefijo viable.

Sea el prefijo viable $ \gamma = \rho \beta_{1} $. A partir
de este prefijo viable, se considera que el elemento
$[A \rightarrow \beta_{1} \cdot \beta_{2}, \sigma_{1}]$
es válido para el prefijo viable $\gamma$ si se cumple lo siguiente:

    \begin{equation}
      \label{eq:LR1-elementovalido}
      \begin{array} {lllll} 
        & S \Dflecha_{D}^{*} \rho A w \Dflecha_{D} \rho \beta_{1} \beta_{2} w
      \end{array}
    \end{equation} 

Donde la D indica que se realiza una derivación por la derecha.
Además, para dicha derivación se empleará una regla de la forma
$ A \rightarrow \beta_{1} \beta_{2}$.

Hasta este punto, si se representa la configuración del análisis
se tendría lo que se muestra en la tabla 

  \begin{table}[H]
  %\footnotesize
  \caption{Elemento LR(1) válido de un prefijo viable.}
  \vspace{10px} 
  \centering
    \begin{tabular}{p{3cm}|p{4cm}|p{5cm}}
      \hline \hline \textbf{Pila} & \textbf{Entrada} & \textbf{Acción} \\
      \hline \dots & \dots & \dots \\
      $\rho$ \underline{$\beta_{1} \beta_{2}$} & \underline{w} \$ & \textbf{reducir} $ A \longrightarrow \beta_{1}\beta_{2} $ \\
      $\rho$ \underline{A} & \underline{w} \$ & \dots \\
      \dots & \dots & \dots \\
      \hline
    \end{tabular}
  \label{tbl:prefijoViable2}
  \end{table}

\subsubsection{Colección canónica}

La colección canónica de LR(1)-elementos permitirá construir un
autómata finito determinista (AFD), para así poder realizar un
análisis sintáctico ascendente \textbf{LR-canónico}. Para su
construcción, se seguirán los siguientes pasos:

\begin{enumerate}
 \item {\textbf{Función clausura}: La función clausura se define de la siguiente
    forma: 

    \begin{itemize}
     \item Un elemento está contenido en su propia clausura. De
      esta forma se tiene que $ I \subseteq clausura (I)$.
     
     \item Si el elemento $ [A \rightarrow \beta_{1} \cdot B \beta_{2}, \sigma_{1}] $
     pertenece a $clausura (I)$, donde se tiene además que $ B \in V_{N} $
     y $ [ B \rightarrow \cdot \gamma, \sigma'] \in clausura (I)$.
     Entones se tiene que $ [ B \rightarrow \cdot \gamma, \sigma'] $
     también pertenece a $clausura (I)$. En este caso, $\sigma'$,
     el símbolo de anticipación, está contenido en $primero (\beta_{2}, \sigma)$.
     En el caso de que $ \beta_{2} = \epsilon $, se tendría que $ \sigma' = \sigma $.
    \end{itemize}
 } 

 \item {\textbf{Función Ir\_a}: Esta función se define de la
  siguiente forma:

    \begin{equation}
      \label{eq:LR1-funcionira}
      \begin{array} {ccccc} 
        & Ir\_a (I, X) = clausura (\{[A \rightarrow \alpha X \cdot \beta, \sigma] \:\: | \:\: [A \rightarrow \alpha \cdot X \beta, \sigma] \in I\}) \\
      \end{array}
    \end{equation}    

  En esta definición, el elemento X es un símbolo ($X \in V = V_{N} \cup V_{T}$). El procedimiento
  indicado en la expresión anterior se podría simplificar diciendo que
  se realiza la clausura a los elementos que tengan el punto ($ \cdot $) detrás
  de la X. Este cálculo se llevará a cabo siempre y cuando la producción
  $ A \rightarrow \alpha \cdot X \beta, \sigma $ pertenezca al conjunto
  de partida.
 }
\end{enumerate}

\subsubsection{Construcción de la tabla LR-canónica}

El algoritmo
para la construcción de la tabla es el que se muestra
 a continuación:

{\bf\em Construcción de la colección canónica de LR(1)-elementos}
\newcount\algocount
\begin{algorithm}
{\bf\em inicio} 
\ $I_{0} \leftarrow clausura({[S' \rightarrow \cdot S, \$]}) $
\ $C \leftarrow {I_{0}} \wedge {I_{0}} $ no marcado 
\ {\bf\em para} cada $I \in C \wedge I $ no marcado {\bf\em hacer} 
\ \ marcar I 
\ \ {\bf\em para} cada $X \in V $ {\bf\em hacer} 
\ \ \  $I' \leftarrow Ir\_a(I, X) $ 
\ \ \ {\bf\em si} $I' \notin C $ 
\ \ \ \ {\bf\em entonces} $C \leftarrow C \cup {I'} \wedge I'$ no marcado 
\ \ \ {\bf\em fin si} 
\ \ {\bf\em fin para} 
\ {\bf\em fin para} 
{\bf\em fin}
\end{algorithm}


El proceso de construcción de la tabla es el siguiente:

\begin{enumerate}
 \item \textbf{Ampliar la gramática} con la regla de producción $ S' \rightarrow S $.
  Así, al crear un nuevo símbolo inicial (S') se consigue que el
  símbolo inicial de la gramática aparezca únicamente \textit{una vez}
  en la parte \textit{izquierda} de una producción.

 \item \textbf{Construir la colección canónica de LR(1)-elementos}.

 \item {\textbf{Rellenar las partes acción de la tabla LR-canónica}.
  Para rellenar cada una de estas partes de la tabla de análisis
  se procederá de la siguiente forma:

    \begin{enumerate}
      \item {Si $ [A \rightarrow \alpha \cdot \sigma \beta, \sigma'] \in I_{i}$
      y se cumple que $ Ir\_a (I_{i}, \sigma) = I_{j} $ y que
      el símbolo $ \sigma $ es un símbolo terminal ($ \sigma \in V_{T} $),
      entonces se tiene que $ accion[i, \sigma] = d{j}$,
      lo cual significa que se desplaza el símbolo y se 
      realiza una transición (en el autómata) hacia el estado
      \textbf{j}.

      \item {Si $ [A \rightarrow  \alpha \cdot, \sigma] \in I_{i}$, 
      cumpliéndose que $\sigma \neq \$$, entonces se tiene que
      $ accion [i, \sigma] = r_{k}$. Esto indica que se tiene una \textbf{reducción},
      donde se tiene que reducir con la regla $ A \rightarrow \alpha \in P$ y
      \textit{únicamente con el símbolo de anticipación}.\footnote{Recuerdese que 
      en el análisis SLR se reducía con todo el conjunto siguiente, mientras que
      en el LR-canónico se reduce únicamente con el símbolo de
      anticipación.
      }}
      
      \item {Si $ [S' \rightarrow S \cdot, \$] \in I_{i}$, entonces
      se tiene que $ accion[i, \$] = ACEPTAR $ y se da por \textbf{finalizado}
      el análisis.
      }


      }
    \end{enumerate}
  }
  \item {Si $ Ir\_a [I_{i}, A] = I_{j} $ y A es un símbolo
  no terminal, entonces se tiene que $ Ir\_a [i, A] = I_{j} $.
  Así se completan las celdas de la tabla Ir\_a.

  }
  \item Las \textit{celdas vacías} de la parte acción representan situaciones
  de \textbf{error}. Estas celdas (al igual que las celdas vacías de esta parte
  de la tabla LR para cualquier método) se pueden completar con
  funciones de tratamiento de errores. Nuevamente, las celdas vacías
  de la parte Ir-a \textit{nunca se consultarán}.

  \item El \textit{estado inicial} del autómata es aquel que se corresponda
  con el conjunto de elementos que \textit{contenga} a $ [S' \rightarrow \cdot S, \$] \in I_{0}$.
\end{enumerate}

\subsubsection{Inconvenientes del método LR-canónico}

Este método, aunque \textit{es el más potente} de los tres que se
presentan, conlleva a un gran coste computacional. Esto
se debe a que la construcción de la \textit{colección canónica}
es \textbf{larga} y muy \textbf{tediosa}. Además, una tabla de análisis LR-canónico
puede llegar a tener muchos estados (lo que repercutirá en el
autómata). En los ejemplos que se emplearán en este documento
se ven análisis LR-canónico relativamente fáciles y predecibles
pero, con una \textit{gramática real}\footnote{Con \textbf{gramática real} se hace
referencia a un caso de una gramática que se use de forma
real y que no se haya creado con fines didácticos o para poner
ejemplos en este documento.}, el autómata podría tener perfectamente
más de 100 estados, haciendo este método impracticable.

\subsubsection{Ejemplo del método LR-canónico}

En el \textit{Apéndice C. Ejemplos de los métodos de análisis ascendente LR}
se muestra un ejemplo del \textbf{método LR-canónico}.

\subsection{Método LALR: Look-Ahead LR}

\subsubsection{Descripción}

El método \textbf{LALR} o \textit{Look-Ahead LR} es un método que se encuentra
a medio camino entre los dos anteriores. Tiene la misma potencia
que podría tener el análisis \textit{SLR} y ocupa exactamente lo mismo.
Es un buen método a considerar para llevar a cabo el análisis
ascendente LR\footnote{Prueba de ello es que este método
es usado en varios generadores automáticos de análisis ascendente,
como puede ser \textbf{YACC} o \textit{Yet Another Compiler Compiler}.}. 

El procedimiento a seguir consiste en unificar aquellos estados
del autómata que sean complementarios. Dichos estados deberán
tener el mismo centro, pero distintos símbolos de anticipación.
Es muy parecido a lo que se mostró en la expresión 
\ref{eq:LR1-elementos11}, solo que ahora interesa agrupar
ambos estados para que sean un único estado en el \textbf{AFD} 
resultante. Sea el siguiente ejemplo:

    \begin{equation}
      \label{eq:LALR1}
      \begin{array} {ccccc} 
        & [A \rightarrow \alpha \cdot B \beta, \sigma_{1}] \in I_{i} \\
        & [A \rightarrow \alpha \cdot B \beta, \sigma_{2}] \in I_{j} \\
	& \Downarrow \\
	& [A \rightarrow \alpha \cdot B \beta, \sigma_{1}, \sigma_{2}] \in I_{i-j} 
      \end{array}
    \end{equation} 

  Así, se realiza la unificación de los estados \textbf{i} ($I_{i}$) y \textbf{j} ($I_{j}$) en un nuevo
  estado \textbf{i-j} ($I_{i-j}$). La \textbf{ventaja} que tiene esta unificación
  es que al unir un estado, los estados a los que \textit{van} (con los que tienen
  transiciones), \textit{también serán unificados}.

  Todo esto hace que el método \textbf{LALR} sea una mejora más que sustancial
  del \textit{LR-canónico}, pero aún así podrían aparecer nuevos conflictos
  que en el método \textit{LR-canónico} no existían. Estos serán planteados
  en la siguiente sección.

\subsubsection{Conflictos}

Como se ha comentado, en este método pueden aparecer nuevos
conflictos que en un análisis por el método LR-canónico
no estarían presentes. Estos se plantean a continuación:

\begin{itemize}
 \item \textbf{Conflicto desplazamiento-reducción}: si en el método
  \textit{LALR} aparece un conflicto de \textit{desplazamiento-reducción},
  también existía en el método \textit{LR-canónico}. En esta propiedad
  también se da la \textbf{relación inversa}. Por tanto, si se tiene
  un análisis LR-canónico sin este tipo de conflictos, se
  puede garantizar que el análisis \textit{LALR} estará libre de ellos.

 \item \textbf{Conflicto reducción-reducción}: este caso es mucho más grave,
  puesto que en el método \textit{LALR} pueden existir conflictos de 
  \textit{reducción-reducción} que en el \textit{LR-canónico} no existían. Esto
  se debe a la unificación de los estados, según lo explicado
  en la sección anterior. Aunque en la ma\-yo\-ría de las ocasiones
  no suele aparecer este conflicto, sería conveniente realizar
  un análisis previo para ver qué estados pueden causar conflictos.
\end{itemize}

\subsubsection{Construcción de la tabla LALR}

Para la construcción de la tabla de análisis LALR se pueden
seguir dos métodos diferentes:

\begin{itemize}
 \item \textbf{Método 1}: Se realiza la colección canónica LR(1)
  y \textbf{después} se unifican los estados resultantes.

 \item \textbf{Método 2}: Se construyen los elementos de la
  colección canónica paso a paso y se van \textbf{unificando}
  los estados \textit{sobre la marcha}. Al realizar la unificación,
  se eliminan los estados originales, además de unificar las 
  transiciones de los estados involucrados.
 
\end{itemize}

\subsubsection{Ejemplo del método LALR}

En el \textit{Apéndice C. Ejemplos de los métodos de análisis ascendente LR}
se muestra un ejemplo del \textbf{método LALR}.

\subsection{Métodos de recuperación de errores}

Estos métodos son aplicados cuando se detecta un error sintáctico durante
el análisis; es decir, cuando se consulta una celda vacía de la parte \textbf{acción}\footnote{Recuerdese que las celdas vacías de la parte \textbf{Ir-a} nunca producirán
error alguno, pues estas celdas \textit{no serán consultadas durante el análisis}.}
el caso que ocupa a este documento.

Existen dos tipos de mecanismos para realizar el tratamiento de
errores. Estos se presentan en las siguientes secciones.
En el \textit{Apéndice C. Ejemplos de los métodos de análisis ascendente LR}
se mostrarán los ejemplos de análisis de cada método aplicando además
estas funciones de recuperación de errores.

\subsubsection{Método de pánico}

El procedimiento para aplicar este método es el que se
describe a con\-ti\-nua\-ción:

\begin{enumerate}
 \item Se \textbf{busca} en la pila algún estado ('\textbf{s}') que tenga transiciones
con un \textit{símbolo no terminal} ('\textbf{A}' por ejemplo, aunque podría haber
otros estados con estas características).
 \item Se \textbf{eliminan} todos los \textit{símbolos} y \textit{estados} que estén por encima
del estado elegido anteriormente.
 \item Se \textbf{introduce} en la pila el símbolo '\textbf{A}'.
 \item Se \textbf{pone} en la pila el estado inidicado por la \textit{transición} $ Ir-a[s, A] = s' $.
 \item Se van \textbf{eliminando} símbolos de la \textit{entrada} hasta que
aparezca un símbolo $\sigma$ tal que $\sigma \in siguiente(A)$. Estos
símbolos $\sigma$ se conocen como \textit{conjunto de sincronización}.
\end{enumerate}

Este método es realmente fácil de aplicar, pero no es capaz
de detectar todos los errores sintácticos posibles. Esto se
debe a que se \textit{salta los símbolos} cuando encuentra 
un error.

\subsubsection{Método de nivel de frase}

Este método consiste en completar todas las \textit{celdas vacías}
de la parte \textbf{acción} con funciones de recuperación de error\footnote{
Nótese nuevamente que no es necesario completar las celdas de la parte 
\textbf{Ir-a}, puesto que \textbf{nunca} se consultarán.}.

Estas funciones de error permiten controlar el análisis y detectar
todos los errores sintácticos. Existe una variación del método
que permite simplificarlo en gran medida. Consiste en buscar
si existen reducciones en los estados de la tabla. Si un estado
posee al menos una reducción, se puede rellenar el resto de las
celdas vacías de ese estado con esa reducción (aunque durante
la construcción de la tabla de análisis no se haya hecho). Así
se consigue \textit{posponer el error}, con el ánimo de que
sea detectado por otro estado.

\subsection{Justificación de los métodos LR}

A continuación se pretende justificar el uso
de los mecanismos LR. Así, se tienen los siguientes
motivos para utilizar dichos mecanismos para realizar
el análisis ascendente:

\begin{itemize}
 \item Es posible \textbf{construir} analizadores sintácticos LR para
  la mayoría de las gramáticas.
 \item El análisis LR es el método de \textit{desplazamiento-reducción}
  más eficiente (sin retroceso).
 \item Si una gramática admite un \textit{análisis descendente predictivo},
  también admite un \textit{análisis LR}. Nótese que lo inverso no es cierto,
  puesto que dicha gramática podría admitir un análisis LR pero
  ser recursiva por la izquierda, por lo que no admitiría el
  análisis descendente.
 \item El análisis LR puede \textbf{detectar un error} tan pronto como sea
  posible, analizando la cadena de entrada de izquierda
  a derecha.
 \item Existen \textbf{generadores automáticos} de analizadores sintácticos
  LR, los cuales ge\-ne\-ran \textit{analizadores sintácticos LALR}. Un ejemplo
  serían los generadores \textit{Yacc} o \textit{Bison} (en su versión para linux).
\end{itemize}

\section {Ejemplos de los métodos de análisis ascendente LR}

\subsection{Ejemplo de SLR}

Sea la gramática cuyas producciones se muestran en la expresión
\ref{eq:gramaticaEjemploSLR}. A continuación, se procederá a construir la tabla
de análisis SLR y reconocer una cadena de entrada. 

   \begin{equation}
    \begin{array}{l}    
	\displaystyle P = \{ \\
	\displaystyle (1) \:\:\: S' \rightarrow S \\
	\displaystyle (2) \:\:\: S \rightarrow S \: D \\
	\displaystyle (3) \:\:\: S \rightarrow D \\
	\displaystyle (4) \:\:\: D \rightarrow T \: L \: \mbox{\bf \em ;} \\
	\displaystyle (5) \:\:\: T \rightarrow \mbox{\bf\em int} \\
	\displaystyle (6) \:\:\: L \rightarrow \mbox{\bf\em id} \\
	\displaystyle (7) \:\:\: L \rightarrow L \: \mbox{\bf \em ,} \: \mbox{\bf\em id} \\
	\displaystyle \}
    \end{array} 
    \label{eq:gramaticaEjemploSLR}
  \end{equation}                
  
\subsubsection{Colección canónica de LR(0)-elementos}

A continuación se procederá con la construcción de la colección canónica
de los e\-le\-men\-tos LR(0). Esta construcción se recoge en las siguientes expresiones
(de la \ref{eq:coleccionI0} a \ref{eq:coleccionI10});
\begin{flushleft}
    \begin{equation}
    \begin{array}{l}    
	\displaystyle I_{0} = clausura(\{S' \rightarrow \bullet S\}) = \{S' \rightarrow \bullet S, S \rightarrow \bullet S D, S \rightarrow \bullet D, D \rightarrow \bullet TL; , T \rightarrow \bullet \: \mbox{\bf\em int}\} \\ \\
        \displaystyle Ir_a(I_{0}, S) = clausura(\{S' \rightarrow S \bullet, S \rightarrow S \bullet D\}) = \\ \{S' \rightarrow S \bullet, S \rightarrow S \bullet D, D \rightarrow \bullet TL; , T \rightarrow \bullet \mbox{\bf\em int}\} = I_{1} \\\\
        \displaystyle Ir_a(I_{0}, D) = clausura(\{S \rightarrow D \: \bullet \}) = (\{S \rightarrow D \: \bullet \}) = I_{2} \\\\
        \displaystyle Ir_a(I_{0}, T) = clausura(\{D \rightarrow T \bullet L\}) = \\ \{D \rightarrow T \bullet L, L \rightarrow \bullet \mbox{\bf \em id}, L \rightarrow \bullet L, \mbox{\bf \em id}\} = I_{3} \\\\
        \displaystyle Ir_a(I_{0}, \mbox{\bf \em int}) = clausura(\{T \rightarrow \mbox{\bf \em int} \: \bullet \}) = \{T \rightarrow \mbox{\bf \em int} \: \bullet \} = I_{4}
    \end{array} 
    \label{eq:coleccionI0}
  \end{equation}                
\end{flushleft}

En la expresión \ref{eq:coleccionI0} se tiene la colección de los elementos de $I_{0}$, que
al utilizar la función de transición \textbf{Ir\_a}, provoca la aparición
de los elementos \textbf{$I_{1}$}, \textbf{$I_{2}$}, \textbf{$I_{3}$} e \textbf{$I_{4}$}. A continuación
se prosigue con estos elementos, aplicando la función \textbf{Ir\_a}
sobre cada uno de ellos y con cada uno de los símbolos que tengan un
punto delante.

\begin{flushleft}
    \begin{equation}
    \begin{array}{l}    
        \displaystyle Ir_a(I_{1}, D) = clausura(\{S \rightarrow S D \bullet \}) = \{S \rightarrow S D \bullet \} = I_{5} \\\\
        \displaystyle Ir_a(I_{1}, T) = clausura(\{D \rightarrow T \bullet L \}) = I_{3} \\\\
        \displaystyle Ir_a(I_{1}, int) = clausura(\{T \rightarrow int \: \bullet \}) = I_{4} \\\\
    \end{array} 
    \label{eq:coleccionI1}
  \end{equation}                
\end{flushleft}

\begin{flushleft}
    \begin{equation}
    \begin{array}{l}    
        \forall X \in V \:\:\:\: Ir_a(I_{2}, X) = \varnothing
    \end{array} 
    \label{eq:coleccionI2}
  \end{equation}                
\end{flushleft}

Nótese que en la expresión \ref{eq:coleccionI1} solamente
se ha \textit{descubierto} un nuevo estado del autómata, puesto que las
otras transiciones ya se encuentran definidas en los elementos \textbf{$I_{3}$} e \textbf{$I_{4}$}.
Por contra, en la expresión \ref{eq:coleccionI2} se tiene que el 
estado \textbf{$I_{2}$} no tiene transición alguna.
En esta situación, solo restaría seguir con los elementos \textbf{$I_{3}$}, \textbf{$I_{4}$} y \textbf{$I_{5}$} (y
con cualquier otro que se pueda producir durante las transiciones de estos).

\begin{flushleft}
    \begin{equation}
    \begin{array}{l}    
        \displaystyle Ir_a(I_{3}, L) = clausura(\{D \rightarrow TL \: \bullet \: ; , L \rightarrow L \bullet\textbf{,} \: id \}) = \\ \{ D \rightarrow TL \: \bullet \: ;, L \rightarrow L \bullet\textbf{,}id  \} = I_{6} \\\\
        \displaystyle Ir_a(I_{3}, id) = clausura(\{L \rightarrow id \: \bullet \}) = \\ \{L \rightarrow id \: \bullet \} = I_{7} \\\\
    \end{array} 
    \label{eq:coleccionI3}
  \end{equation}
\end{flushleft}

\begin{flushleft}
  \begin{equation}
    \begin{array}{l}    
        \forall X \in V \:\:\:\: Ir_a(I_{4}, X) = \varnothing
    \end{array} 
    \label{eq:coleccionI4}
  \end{equation}
\end{flushleft}

\begin{flushleft}
  \begin{equation}
    \begin{array}{l}    
        \forall X \in V \:\:\:\: Ir_a(I_{5}, X) = \varnothing
    \end{array} 
    \label{eq:coleccionI5}
  \end{equation}
\end{flushleft}


En la expresión \ref{eq:coleccionI3} se identifican dos nuevos estados
(Nótese que en el elemento $\underline{L \rightarrow L \bullet\textbf{,}id}$ la coma
',' forma parte de él, no siendo ningún separador de elementos). De la misma forma
que en las ecuaciones anteriores, los elementos \textbf{$I_{4}$} e \textbf{$I_{5}$} no tienen transiciones

\begin{flushleft}
    \begin{equation}
    \begin{array}{l}    
        \displaystyle Ir_a(I_{6}, ';') = clausura(\{D \rightarrow TL ; \bullet \}) = \{ D \rightarrow TL ; \bullet  \} = I_{8} \\\\
        \displaystyle Ir_a(I_{6}, ',') = clausura(\{L \rightarrow L, \bullet \: id \}) = \{L \rightarrow L, \bullet \: id \} = I_{9} \\\\
    \end{array} 
    \label{eq:coleccionI6}
  \end{equation}
\end{flushleft}

\begin{flushleft}
  \begin{equation}
    \begin{array}{l}    
        \forall X \in V \:\:\:\: Ir_a(I_{7}, X) = \varnothing
    \end{array} 
    \label{eq:coleccionI7}
  \end{equation}
\end{flushleft}

\begin{flushleft}
  \begin{equation}
    \begin{array}{l}    
        \forall X \in V \:\:\:\: Ir_a(I_{8}, X) = \varnothing
    \end{array} 
    \label{eq:coleccionI8}
  \end{equation}
\end{flushleft}

Finalmente, ya solo queda por analizar $I_{9}$ que, como se observa
en \ref{eq:coleccionI9} produce el estado $I_{10}$, el cual ya no posee ninguna transición.

\begin{flushleft}
    \begin{equation}
    \begin{array}{l}    
        \displaystyle Ir_a(I_{9}, id) = clausura(\{ L \rightarrow L, id \: \bullet \}) = \\ \{ L \rightarrow L, id \: \bullet \} = I_{10} \\\\
    \end{array} 
    \label{eq:coleccionI9}
  \end{equation}
\end{flushleft}

\begin{flushleft}
  \begin{equation}
    \begin{array}{l}    
        \forall X \in V \:\:\:\: Ir_a(I_{10}, X) = \varnothing
    \end{array} 
    \label{eq:coleccionI10}
  \end{equation}
\end{flushleft}

Así se da por finalizada la construcción de la colección canónica
de elementos LR(0).

\subsubsection{Autómata que reconoce los prefijos viables}

Una vez construida la colección LR(0), se puede determinar un
autómata finito determinista (AFD) que reconoce los \textbf{prefijos
viables}. Véase la tabla \ref{tbl:ejemploSLRAFD} para más información.

  \begin{table}[H]
  %\footnotesize
  \caption{Ejemplo SLR. Autómata que reconoce los prefijos viables}
  \vspace{10px} 
  \centering
    \begin{tabular}{| c | c | c | c | c | c | c | c | c |}
      \hline \hline
      Estado & \textbf{S} & \textbf{D} & \textbf{T} & \textbf{L} & \textbf{;} & \textbf{int} & \textbf{id} & \textbf{,} \\ 
      \hline \textbf{0} & 1 & 2 & 3 &  &  & 4 &  &  \\ 
      \hline \textbf{1} &  & 5 & 3 &  &  & 4 &  &  \\ 
      \hline \textbf{2} &  &  &  &  &  &  &  &  \\ 
      \hline \textbf{3} &  &  &  & 6 &  &  & 7 &  \\ 
      \hline \textbf{4} &  &  &  &  &  &  &  &  \\ 
      \hline \textbf{5} &  &  &  &  &  &  &  &  \\ 
      \hline \textbf{6} &  &  &  &  & 8 &  &  & 9 \\ 
      \hline \textbf{7} &  &  &  &  &  &  &  &  \\ 
      \hline \textbf{8} &  &  &  &  &  &  &  &  \\ 
      \hline \textbf{9} &  &  &  &  &  &  & 10 &  \\ 
      \hline \textbf{10} &  &  &  &  &  &  &  &  \\ 
      \hline
    \end{tabular}
  \label{tbl:ejemploSLRAFD}
  \end{table}

En el AFD obtenido se tiene que el estado inicial es \textbf{$I_{0}$}, por
contener la regla $S' \rightarrow S$ y todos los estados del
autómata son finales. Una representación más \textit{intuitiva}
de este autómata se muestra en la figura \ref{fig:figura_slr_afd}.

\begin{figure}[H]
  \begin{center} 
    \includegraphics[width=0.8\textwidth]{img/grafo1.jpg}
    \caption{Ejemplo SLR. Representación gráfica del AFD}
    \label{fig:figura_slr_afd}
  \end{center}
\end{figure}

\subsubsection{Tabla SLR}

Una vez construida la colección canónica LR(0) y el AFD que
reconoce los prefijos viables, se puede crear la tabla de análisis
SLR. Antes de crear dicha tabla, convendría obtener los conjuntos
primero y siguiente, para cada uno de los símbolos no terminales
de la gramática (que son \textbf{S}, \textbf{D}, \textbf{T} y \textbf{L}). Estos conjuntos
se muestran en la tabla \ref{tbl:ejemploSLRPrimeroSiguiente}.

  \begin{table}[H]
  %\footnotesize
  \caption{Ejemplo SLR. Conjuntos primero y siguiente}
  \vspace{10px} 
  \centering
    \begin{tabular}{| c | c | c |}
      \hline \hline
      & \textbf{PRIMERO} & \textbf{SIGUIENTE}  \\
      \hline \textbf{S} & int & \$ \\
      \hline \textbf{D} & int & \$ \\
      \hline \textbf{T} & int & id \\
      \hline \textbf{L} & id & ';' y ',' \\
      \hline
    \end{tabular}
  \label{tbl:ejemploSLRPrimeroSiguiente}
  \end{table}

Con estos conjuntos calculados, se podrá terminar de rellenar
la tabla SLR. Nótese que la parte acción contiene desplazamientos
y reducciones, mientras que la parte Ir-a contiene transiciones
del AFD. Por su parte, el elemento LR(0) que contiene
la regla $S' \rightarrow S \bullet$ tiene una transición especial
con el símbolo \$. Esta transición implica que, llegado ese
punto, la cadena es reconocida y se termina el análisis (éxito).
La tabla LR se refleja en la tabla \ref{tbl:ejemploSLRTablaLR}

  \begin{table}[H]
  %\footnotesize
  \caption{Ejemplo SLR. Tabla SLR}
  \vspace{10px} 
  \centering
    \begin{tabular}{| c | c | c | c | c | c || c | c | c | c |}
      \hline \hline
      & \multicolumn{5}{c||}{\textcolor{blue}{\textbf{Acción}}} & \multicolumn{4}{c|}{\textcolor{blue}{\textbf{Ir-a}}} \\
      \hline \textbf{Estado} & \textbf{;} & \textbf{int} & \textbf{id} & \textbf{,} & \textbf{\$} & \textbf{S} & \textbf{D} & \textbf{T} & \textbf{L} \\ 
      \hline 0 & & \textcolor{blue}{\textbf{d4}} & & & & 1 & 2 & 3 & \\
      \hline 1 & & \textcolor{blue}{\textbf{d4}} & & & \textcolor{verdeOscuro}{\textbf{Aceptar}} & & 5 & 3 & \\
      \hline 2 & & & & & \textcolor{magenta}{\textbf{r2}} & & & & \\
      \hline 3 & & & \textcolor{blue}{\textbf{d7}} & & & & & & 6 \\
      \hline 4 & & & \textcolor{magenta}{\textbf{r4}} & & & & & & \\ 
      \hline 5 & & & & & \textcolor{magenta}{\textbf{r1}} & & & & \\
      \hline 6 & \textcolor{blue}{\textbf{d8}} & & & \textcolor{blue}{\textbf{d9}} & & & & & \\ 
      \hline 7 & \textcolor{magenta}{\textbf{r5}} & & & \textcolor{magenta}{\textbf{r5}} & & & & & \\ 
      \hline 8 & & & & & \textcolor{magenta}{\textbf{r3}} & & & & \\
      \hline 9 & & & \textcolor{blue}{\textbf{d10}} & & & & & & \\
      \hline 10 & \textcolor{magenta}{\textbf{r6}} & & & \textcolor{magenta}{\textbf{r6}} & & & & & \\ 
      \hline
    \end{tabular}
  \label{tbl:ejemploSLRTablaLR}
  \end{table}

Por otro lado, para realizar un \textbf{control de errores} durante el análisis,
se podría recurrir a alguno de los dos métodos presentados
en el Apéndice B. En este caso, se ha optado por aplicar el 
método de nivel de frase. Para aplicar este método, se han rellenado
las filas con reducciones (solamente aquellas en las que había
alguna reducción, como es el caso de los estados 2, 4, 5, 7, 8 y 10).
Estas reducciones \textit{añadidas} se han marcado en negro.
Respecto a las funciones de error del método, se han definido
las siguientes:

\begin{itemize}
 \item \textbf{E1: Símbolo inesperado}. Se borra el símbolo de la entrada.
 \item \textbf{E2: Se esperaba un tipo}. Se introduce en la entrada
  el símbolo no terminal \textbf{int}.
 \item \textbf{E3: Fin de cadena inesperado}. Se termina el análisis.
 \item \textbf{E4: Falta identificador}. Se introduce en la entrada
  el símbolo no terminal \textbf{identificador}. 
 \item \textbf{E5: Símbolo duplicado}. Se elimina el símbolo.
 \item \textbf{E6: Se esperaba separador (',') o fin de sentencia (';')}. Se inserta ';'.
\end{itemize}

Finalmente, en la tabla \ref{tbl:ejemploSLRTablaLR1} se muestra
la tabla completada.

  \begin{table}[H]
  %\footnotesize
  \caption{Ejemplo SLR. Tabla SLR completada con el método de nivel de frase}
  \vspace{10px} 
  \centering
    \begin{tabular}{| c | c | c | c | c | c || c | c | c | c |}
      \hline \hline
      & \multicolumn{5}{c||}{\textcolor{blue}{\textbf{Acción}}} & \multicolumn{4}{c|}{\textcolor{blue}{\textbf{Ir a}}} \\
      \hline \textbf{Estado} & \textbf{;} & \textbf{int} & \textbf{id} & \textbf{,} & \textbf{\$} & \textbf{S} & \textbf{D} & \textbf{T} & \textbf{L} \\ 
      \hline 0 & \textcolor{red}{\textbf{E1}} & \textcolor{blue}{\textbf{d4}} & \textcolor{red}{\textbf{E2}} & \textcolor{red}{\textbf{E1}} & \textcolor{red}{\textbf{E3}} & 1 & 2 & 3 & \\
      \hline 1 & \textcolor{red}{\textbf{E1}} & \textcolor{blue}{\textbf{d4}} & \textcolor{red}{\textbf{E1}} & \textcolor{red}{\textbf{E1}} & \textcolor{verdeOscuro}{\textbf{Aceptar}} & & 5 & 3 & \\
      \hline 2 & \textcolor{black}{\textbf{r2}} & \textcolor{black}{\textbf{r2}} & \textcolor{black}{\textbf{r2}} & \textcolor{black}{\textbf{r2}} & \textcolor{magenta}{\textbf{r2}} & & & & \\
      \hline 3 & \textcolor{red}{\textbf{E4}} & \textcolor{red}{\textbf{E5}} & \textcolor{blue}{\textbf{d7}} & \textcolor{red}{\textbf{E1}} & \textcolor{red}{\textbf{E3}} & & & & 6 \\
      \hline 4 & \textcolor{black}{\textbf{r4}} & \textcolor{black}{\textbf{r4}} & \textcolor{magenta}{\textbf{r4}} & \textcolor{black}{\textbf{r4}} & \textcolor{black}{\textbf{r4}} & & & & \\ 
      \hline 5 & \textcolor{black}{\textbf{r1}} & \textcolor{black}{\textbf{r1}} & \textcolor{black}{\textbf{r1}} & \textcolor{black}{\textbf{r1}} & \textcolor{magenta}{\textbf{r1}} & & & & \\
      \hline 6 & \textcolor{blue}{\textbf{d8}} & \textcolor{red}{\textbf{E6}} & \textcolor{red}{\textbf{E6}} & \textcolor{blue}{\textbf{d9}} & \textcolor{red}{\textbf{E6}} & & & & \\ 
      \hline 7 & \textcolor{magenta}{\textbf{r5}} & \textcolor{black}{\textbf{r5}} & \textcolor{black}{\textbf{r5}} & \textcolor{magenta}{\textbf{r5}} & \textcolor{black}{\textbf{r5}} & & & & \\ 
      \hline 8 & \textcolor{black}{\textbf{r3}} & \textcolor{black}{\textbf{r3}} & \textcolor{black}{\textbf{r3}} & \textcolor{black}{\textbf{r3}} & \textcolor{magenta}{\textbf{r3}} & & & & \\
      \hline 9 & \textcolor{red}{\textbf{E1}} & \textcolor{red}{\textbf{E1}} & \textcolor{blue}{\textbf{d10}} & \textcolor{red}{\textbf{E1}} & \textcolor{red}{\textbf{E3}} & & & & \\
      \hline 10 & \textcolor{magenta}{\textbf{r6}} & \textcolor{black}{\textbf{r6}} & \textcolor{black}{\textbf{r6}} & \textcolor{magenta}{\textbf{r6}} & \textcolor{black}{\textbf{r6}} & & & & \\ 
      \hline
    \end{tabular}
  \label{tbl:ejemploSLRTablaLR1}
  \end{table}

\subsubsection{Análisis de una cadena de entrada}

A continuación, en la tabla \ref{tbl:analisis1}, se muestra
el resultado de analizar la cadena de entrada \textbf{int id; int id, id}.
Nótese que en esta cadena de entrada se ha omitido el ';' final, con objeto de provocar,
de forma intencionada, un error durante el análisis.

Durante la ejecución del análisis, hay un punto en el que se utilizan
una de las reducciones marcadas en \textbf{negro} (método de nivel de frase). Esta
acción hace que se \textbf{postponga} el error a un estado en el que
será tratado por una función de error (función E1).

  \begin{table}[H]
      \begin{tabular}{|p{4cm}|p{3.5cm}|p{6.5cm}|}
	\hline \hline \textbf{Pila} & \textbf{Entrada} & \textbf{Acción} \\
	\hline \textcolor{blue}{0} & \textcolor{blue}{int} id; int id, id \$ & \textcolor{blue}{d} 4 \\
	\hline 0 \textcolor{blue}{int 4} & \textcolor{blue}{id}; int id, id \$ & \textcolor{magenta}{r }$(4) \: T \rightarrow int $\\
	\hline 0 T \textcolor{blue}{3} & \textcolor{blue}{id}; int id, id \$ & \textcolor{blue}{d} 7 \\
	\hline 0 T 3 \textcolor{blue}{id 7} & \textcolor{blue}{;} int id, id \$ & \textcolor{magenta}{r }$(5) \: L \rightarrow id $\\
	\hline 0 T 3 L \textcolor{blue}{6} & \textcolor{blue}{;} int id, id \$ & \textcolor{blue}{d} 8 \\
	\hline 0 \textcolor{blue}{T 3 L 6 ; 8} & \textcolor{blue}{int} id, id \$ & \textcolor{magenta}{r }$(3) \: D \rightarrow TL; $\\
	\hline 0 \textcolor{blue}{D 2} & \textcolor{blue}{int} id, id \$ & \textcolor{verde-oscuro}{r }$(2) \: S \rightarrow D $\\
	\hline 0 S \textcolor{blue}{1} & \textcolor{blue}{int} id, id \$ & \textcolor{blue}{d} 4 \\
	\hline 0 S 1 \textcolor{blue}{int 4} & \textcolor{blue}{id} , id \$ & \textcolor{magenta}{r }$(4) \: T \rightarrow int $\\
	\hline 0 S 1 T \textcolor{blue}{3} & \textcolor{blue}{id} , id \$ & \textcolor{blue}{d} 7\\
	\hline 0 S 1 T 3 \textcolor{blue}{id 7} & \textcolor{blue}{,} id \$ & \textcolor{magenta}{r }$(5) \: L \rightarrow id $\\
	\hline 0 S 1 T 3 L \textcolor{blue}{6} & \textcolor{blue}{,} id \$ & \textcolor{blue}{d} 9\\
	\hline 0 S 1 T 3 L 6 , \textcolor{blue}{9} & \textcolor{blue}{id} \$ & \textcolor{blue}{d} 10\\
	\hline 0 S 1 T 3 \textcolor{blue}{L 6 , 9 id 10} & \textcolor{blue}{\$} & \textcolor{black}{r }$(6) \: L\rightarrow L,id $ - Se postpone el error.\\
	\hline 0 S 1 T 3 L \textcolor{blue}{6} & \textcolor{blue}{\$} & \textcolor{red}{E6} Se inserta ';'\\
	\hline 0 S 1 T 3 L \textcolor{blue}{6} & \textcolor{blue}{;} \$ & \textcolor{blue}{d} 8\\
	\hline 0 S 1 \textcolor{blue}{T 3 L 6 ; 8} & \textcolor{blue}{\$} & \textcolor{magenta}{r }$(3) \: D \rightarrow TL; $\\
	\hline 0 \textcolor{blue}{S 1 D 5} & \textcolor{blue}{\$} & \textcolor{magenta}{r }$(1) \: S \rightarrow SD $\\
	\hline 0 S \textcolor{blue}{1} & \textcolor{blue}{\$} & \textcolor{verdeOscuro}{ACEPTAR}\\
      \hline
      \end{tabular}
      \caption{Ejemplo SLR. Tabla de análisis}
      \label{tbl:analisis1}
  \end{table}

\subsection{Ejemplo de LR-canónico}

Sea la gramática cuyas producciones se muestran en la expresión
\ref{eq:gramaticaEjemploLR}. A continuación, se procederá a 
construir la tabla
de análisis LR y reconocer una cadena de entrada. 

   \begin{equation}
    \begin{array}{l}    
	\displaystyle P = \{ \\
	\displaystyle (1') \:\:\: S' \rightarrow S \\
	\displaystyle (1) \:\:\: S \rightarrow C \: C \\
	\displaystyle (2) \:\:\: C \rightarrow \mbox{\bf \em a} \: C \\
	\displaystyle (3) \:\:\: C \rightarrow \mbox{\bf \em d}a \\
	\displaystyle \}
    \end{array} 
    \label{eq:gramaticaEjemploLR}
  \end{equation}                
  
\subsubsection{Colección canónica de LR(1)-elementos}

A continuación se procederá con la construcción de la colección canónica
de los e\-le\-men\-tos LR(1). Esta construcción se recoge en las siguientes expresiones
(de la \ref{eq:coleccionI0_LR} a \ref{eq:coleccionI8_LR});
\begin{flushleft}
    \begin{equation}
    \begin{array}{l}    
	\displaystyle I_{0} = clausura(\{[S' \rightarrow \bullet S, \$]\}) = \{[S' \rightarrow \bullet S, \$], [S \rightarrow \bullet C C, \$], \\
        \displaystyle [C \rightarrow \bullet a C, \mbox{\bf\em \textcolor{black}{a}}, \mbox{\bf\em \textcolor{black}{d}}], [C \rightarrow \bullet d, \mbox{\bf\em \textcolor{black}{a}}, \mbox{\bf\em \textcolor{black}{d}}] \} \\
        \displaystyle Ir\_a(I_{0}, S) = clausura(\{[S' \rightarrow S \bullet, \mbox{\bf\em \textcolor{black}{\$}}]\}) = \{[S' \rightarrow S \bullet, \mbox{\bf\em \textcolor{black}{\$}}]\} = I_{1} \\ \\ 
	\displaystyle Ir\_a(I_{0}, C) = clausura(\{[S \rightarrow C \bullet C, \mbox{\bf\em \textcolor{black}{\$}}]\}) = \{[S \rightarrow C \bullet C, \mbox{\bf\em \textcolor{black}{\$}}], \\ 
	\displaystyle [C \rightarrow \bullet a C, \mbox{\bf\em \textcolor{black}{\$}}], [C \rightarrow \bullet d, \mbox{\bf\em \textcolor{black}{\$}}]\} = I_{2} \\ \\ 
	\displaystyle Ir\_a(I_{0}, a) = clausura(\{[C \rightarrow a \bullet C, \mbox{\bf\em \textcolor{black}{a}}, \mbox{\bf\em \textcolor{black}{d}}]\}) = \{[C \rightarrow a \bullet C, \mbox{\bf\em \textcolor{black}{a}}, \mbox{\bf\em \textcolor{black}{d}}], \\ 
	\displaystyle [C \rightarrow \bullet a C, \mbox{\bf\em \textcolor{black}{a}}, \mbox{\bf\em \textcolor{black}{d}}], [C \rightarrow \bullet d, \mbox{\bf\em \textcolor{black}{a}}, \mbox{\bf\em \textcolor{black}{d}}]\} = I_{3} \\ \\    
	\displaystyle Ir\_a(I_{0}, d) = clausura(\{[C \rightarrow d \bullet, \mbox{\bf\em \textcolor{black}{a}}, \mbox{\bf\em \textcolor{black}{d}}]\}) = {[C \rightarrow d \bullet, \mbox{\bf\em \textcolor{black}{a}}, \mbox{\bf\em \textcolor{black}{d}}]} = I_{4} \\

\end{array} 
    \label{eq:coleccionI0_LR}
  \end{equation}                
\end{flushleft}

En la expresión \ref{eq:coleccionI0_LR} se tiene la colección de los elementos de $I_{0}$, que
al utilizar la función de transición \textbf{Ir\_a}, provoca la aparición
de los elementos \textbf{$I_{1}$}, \textbf{$I_{2}$}, \textbf{$I_{3}$} y \textbf{$I_{4}$}. A continuación
se prosigue con estos elementos, aplicando la función \textbf{Ir\_a}
sobre cada uno de ellos y con cada uno de los símbolos que tengan un
punto delante.

\begin{flushleft}
    \begin{equation}
    \begin{array}{l}    
        \forall X \in V \:\:\:\: Ir\_a(I_{1}, X) = \varnothing 
    \end{array} 
    \label{eq:coleccionI1_LR}
  \end{equation}                
\end{flushleft}

\begin{flushleft}
    \begin{equation}
    \begin{array}{l}    
	\displaystyle Ir\_a(I_{2}, C) = clausura(\{[S \rightarrow C C \bullet, \mbox{\bf\em \textcolor{black}{\$}}]\}) = \{[S \rightarrow C C \bullet, \mbox{\bf\em \textcolor{black}{\$}}]\} = I_{5} \\ \\
	\displaystyle Ir\_a(I_{2}, a) = clausura(\{[C \rightarrow a \bullet C, \mbox{\bf\em \textcolor{black}{\$}}]\}) = \{[C \rightarrow a \bullet C, \mbox{\bf\em \textcolor{black}{\$}}]\}, \\
	\displaystyle [C \rightarrow \bullet a C, \mbox{\bf\em \textcolor{black}{\$}}], [C \rightarrow \bullet d, \mbox{\bf\em \textcolor{black}{\$}}]\} = I_{6} \\ \\
	\displaystyle Ir\_a(I_{2}, d) = clausura(\{[C \rightarrow d \bullet, \mbox{\bf\em \textcolor{black}{\$}}]\}) = \{[C \rightarrow d \bullet, \mbox{\bf\em \textcolor{black}{\$}}]\} = I_{7} 
    \end{array} 
    \label{eq:coleccionI2_LR}
  \end{equation}                
\end{flushleft}

\begin{flushleft}
    \begin{equation}
    \begin{array}{l}    
	\displaystyle Ir\_a(I_{3}, C) = clausura(\{[S \rightarrow C C \bullet, \mbox{\bf\em \textcolor{black}{a}}, \mbox{\bf\em \textcolor{black}{d}}]\}) = \\
	\displaystyle \{[S \rightarrow C C \bullet, \mbox{\bf\em \textcolor{black}{a}}, \mbox{\bf\em \textcolor{black}{d}}]\} = I_{8} \\ \\
	\displaystyle Ir\_a(I_{3}, a) = clausura(\{[C \rightarrow a \bullet C, \mbox{\bf\em \textcolor{black}{a}}, \mbox{\bf\em \textcolor{black}{d}}]\}) = I_{3} \\ \\
	\displaystyle Ir\_a(I_{3}, d) = clausura(\{[C \rightarrow d \bullet, \mbox{\bf\em \textcolor{black}{a}}, \mbox{\bf\em \textcolor{black}{d}}]\}) = \{[C \rightarrow d \bullet, \mbox{\bf\em \textcolor{black}{a}}, \mbox{\bf\em \textcolor{black}{d}}]\} = I_{4} 
    \end{array} 
    \label{eq:coleccionI3_LR}
  \end{equation}
\end{flushleft}

Nótese que en el \textbf{estado 1} (\ref{eq:coleccionI1_LR}) no se tiene
ninguna transición, mientras que en el \textbf{estado 2} (\ref{eq:coleccionI2_LR})
se han \textit{descubierto} tres nuevos estado del autómata.
Por su parte, en el \textbf{estado 3} (\ref{eq:coleccionI3_LR}) aparece
un nuevo estado (estado 8). Ahora habría
que continuar calculando los elementos \textbf{$I_{4}$}, \textbf{$I_{5}$}, \textbf{$I_{6}$},
\textbf{$I_{7}$} y \textbf{$I_{8}$} (incluyendo cualquier otro estado que pueda aparecer durante las transiciones de estos).

\begin{flushleft}
  \begin{equation}
    \begin{array}{l}    
        \forall X \in V \:\:\:\: Ir\_a(I_{4}, X) = \varnothing 
    \end{array} 
    \label{eq:coleccionI4_LR}
  \end{equation}
\end{flushleft}

\begin{flushleft}
  \begin{equation}
    \begin{array}{l}    
        \forall X \in V \:\:\:\: Ir_a(I_{5}, X) = \varnothing
    \end{array} 
    \label{eq:coleccionI5_LR}
  \end{equation}
\end{flushleft}

\begin{flushleft}
  \begin{equation}
    \begin{array}{l}    
	\displaystyle Ir\_a(I_{6}, C) = clausura(\{[S \rightarrow C C \bullet, \mbox{\bf\em \textcolor{black}{\$}}]\}) = I_{5} \\ \\
	\displaystyle Ir\_a(I_{6}, a) = clausura(\{[C \rightarrow a \bullet C, \mbox{\bf\em \textcolor{black}{\$}}]\}) = I_{6} \\ \\
	\displaystyle Ir\_a(I_{6}, d) = clausura(\{[C \rightarrow d \bullet, \mbox{\bf\em \textcolor{black}{a}}]\}) = I_{7}  
    \end{array} 
    \label{eq:coleccionI6_LR}
  \end{equation} 
\end{flushleft}

\begin{flushleft}
  \begin{equation}
    \begin{array}{l}    
        \forall X \in V \:\:\:\: Ir\_a(I_{7}, X) = \varnothing     
    \end{array} 
    \label{eq:coleccionI7_LR}
  \end{equation} 
\end{flushleft}

\begin{flushleft}
  \begin{equation}
    \begin{array}{l}    
        \forall X \in V \:\:\:\: Ir\_a(I_{8}, X) = \varnothing    
    \end{array} 
    \label{eq:coleccionI8_LR}
  \end{equation} 
\end{flushleft}


Tras haber construido el resto de estados que faltaban (del 4 al 8), no ha 
aparecido ningún nuevo estado en la colección canónica. Por tanto, se da por finalizada la construcción de la colección canónica
de elementos LR(1).

\subsubsection{Autómata que reconoce los prefijos viables}

Una vez construida la colección LR(1), se puede determinar un
autómata finito determinista (AFD) que reconoce los \textbf{prefijos
viables}. Véase la tabla \ref{tbl:ejemploLRAFD} para más información.

  \begin{table}[H]
  %\footnotesize
  \caption{Ejemplo LR. Autómata que reconoce los prefijos viables}
  \vspace{10px} 
  \centering
    \begin{tabular}{| c | c | c | c | c |}
      \hline \hline
      Estado & \textbf{S} & \textbf{C} & \textbf{a} & \textbf{d} \\ 
      \hline \textbf{0} & 1 & 2 & 3 & 4 \\ 
      \hline \textbf{1} &  &  &  &  \\ 
      \hline \textbf{2} &  & 5 & 6 & 7 \\ 
      \hline \textbf{3} &  & 8 & 3 & 4 \\ 
      \hline \textbf{4} &  &  &  &  \\ 
      \hline \textbf{5} &  &  &  &  \\ 
      \hline \textbf{6} &  & 5 & 6 & 7 \\ 
      \hline \textbf{7} &  &  &  &  \\ 
      \hline \textbf{8} &  &  &  &  \\ 
      \hline
    \end{tabular}
  \label{tbl:ejemploLRAFD}
  \end{table}

En el AFD obtenido se tiene que el estado inicial es \textbf{$I_{0}$}, por
contener la regla $S' \rightarrow S$ y todos los estados del
autómata son finales. Una representación más \textit{intuitiva}
de este autómata se muestra en la figura \ref{fig:figura_lr_afd}.

\begin{figure}[H]
  \begin{center} 
    \includegraphics[width=0.7\textwidth]{img/grafo22.jpg}
    \caption{Ejemplo LR. Representación gráfica del AFD}
    \label{fig:figura_lr_afd}
  \end{center}
\end{figure}

\subsubsection{Tabla LR}

Una vez construida la colección canónica LR(1) y el AFD que
reconoce los prefijos viables, se puede crear la tabla de análisis
LR. Antes de crear dicha tabla, convendría obtener los conjuntos
primero y siguiente, para cada uno de los símbolos no terminales
de la gramática (que son \textbf{S} y \textbf{D}). Estos conjuntos
se muestran en la tabla \ref{tbl:ejemploLRPrimeroSiguiente}.

  \begin{table}[H]
  %\footnotesize
  \caption{Ejemplo LR. Conjuntos primero y siguiente}
  \vspace{10px} 
  \centering
    \begin{tabular}{| c | c | c |}
      \hline \hline
      & \textbf{PRIMERO} & \textbf{SIGUIENTE}  \\
      \hline \textbf{S} & a, d & \$ \\
      \hline \textbf{D} & a, d & \$, a, d \\
      \hline
    \end{tabular}
  \label{tbl:ejemploLRPrimeroSiguiente}
  \end{table}

Con estos conjuntos calculados, se podrá terminar de rellenar
la tabla LR. Nótese que la parte acción contiene desplazamientos
y reducciones, mientras que la parte Ir-a contiene transiciones
del AFD. Por su parte, el elemento LR(1) que contiene
la regla $S' \rightarrow S \bullet$ tiene una transición especial
con el símbolo \$. Esta transición implica que, llegado ese
punto, la cadena es reconocida y se termina el análisis (éxito).
La tabla LR se refleja en la tabla \ref{tbl:ejemploLRTablaLR}

  \begin{table}[H]
  %\footnotesize
  \caption{Ejemplo LR. Tabla LR}
  \vspace{10px} 
  \centering
    \begin{tabular}{| c | c | c | c || c | c |}
      \hline \hline
      & \multicolumn{3}{c||}{\textcolor{blue}{\textbf{Acción}}} & \multicolumn{2}{c|}{\textcolor{blue}{\textbf{Ir-a}}} \\
      \hline \textbf{Estado} & \textbf{a} & \textbf{d} & \textbf{\$} & \textbf{S} & \textbf{C}\\ 
      \hline 0 & \textcolor{blue}{\textbf{d3}} & \textcolor{blue}{\textbf{d4}} & & 1 & 2 \\
      \hline 1 & & & \textcolor{verdeOscuro}{ACEPTAR} & & \\
      \hline 2 & \textcolor{blue}{\textbf{d6}} & \textcolor{blue}{\textbf{d7}} & & & 5 \\
      \hline 3 & \textcolor{blue}{\textbf{d3}} & \textcolor{blue}{\textbf{d4}} & & & 8 \\
      \hline 4 & \textcolor{magenta}{\textbf{r3}} & \textcolor{magenta}{\textbf{r3}} & & & \\
      \hline 5 & & & \textcolor{magenta}{\textbf{r1}} & & \\
      \hline 6 & \textcolor{blue}{\textbf{d6}} & \textcolor{blue}{\textbf{d7}} & & & 5 \\
      \hline 7 & & & \textcolor{magenta}{\textbf{r3}} & & \\
      \hline 8 & \textcolor{magenta}{\textbf{r2}} & \textcolor{magenta}{\textbf{r2}} & & & \\
      \hline
    \end{tabular}
  \label{tbl:ejemploLRTablaLR}
  \end{table}

Por otro lado, para realizar un control de errores durante el análisis,
se podría recurrir a alguno de los dos métodos presentados
en el Apéndice B. En este caso, se ha optado por aplicar el 
método de nivel de frase. Para aplicar este método, se han rellenado
las filas con reducciones (solamente aquellas en las que había
alguna reducción, como es el caso de los estados 4, 5, 7 y 8).
Estas reducciones \textit{añadidas} se han marcado en negro.
Respecto a las funciones de error del método, se han definido
las siguientes:

\begin{itemize}
 \item \textbf{E1: Símbolo inesperado}. Se borra el símbolo de la entrada.
 \item \textbf{E2: Fin de cadena inesperado}. Se termina el análisis de forma insatisfactoria.
\end{itemize}

Finalmente, en la tabla \ref{tbl:ejemploLRTablaLR1} se muestra
la tabla completada.

  \begin{table}[H]
  %\footnotesize
  \caption{Ejemplo LR. Tabla LR completada con el método de nivel de frase}
  \vspace{10px} 
  \centering
    \begin{tabular}{| c | c | c | c || c | c |}
      \hline \hline
      & \multicolumn{3}{c||}{\textcolor{blue}{\textbf{Acción}}} & \multicolumn{2}{c|}{\textcolor{blue}{\textbf{Ir-a}}} \\
      \hline \textbf{Estado} & \textbf{a} & \textbf{d} & \textbf{\$} & \textbf{S} & \textbf{C}\\ 
      \hline 0 & \textcolor{blue}{\textbf{d3}} & \textcolor{blue}{\textbf{d4}} & \textcolor{red}{\textbf{E2}} & 1 & 2 \\
      \hline 1 & \textcolor{red}{\textbf{E1}} & \textcolor{red}{\textbf{E1}} & \textcolor{verdeOscuro}{ACEPTAR} & & \\
      \hline 2 & \textcolor{blue}{\textbf{d6}} & \textcolor{blue}{\textbf{d7}} & \textcolor{red}{\textbf{E2}} & & 5 \\
      \hline 3 & \textcolor{blue}{\textbf{d3}} & \textcolor{blue}{\textbf{d4}} & \textcolor{red}{\textbf{E2}} & & 8 \\
      \hline 4 & \textcolor{magenta}{\textbf{r3}} & \textcolor{magenta}{\textbf{r3}} & \textcolor{black}{\textbf{r3}} & & \\
      \hline 5 & \textcolor{black}{\textbf{r1}} & \textcolor{black}{\textbf{r1}} & \textcolor{magenta}{\textbf{r1}} & & \\
      \hline 6 & \textcolor{blue}{\textbf{d6}} & \textcolor{blue}{\textbf{d7}} & \textcolor{red}{\textbf{E2}} & & 5 \\
      \hline 7 & \textcolor{black}{\textbf{r3}} & \textcolor{black}{\textbf{r3}} & \textcolor{magenta}{\textbf{r3}} & & \\
      \hline 8 & \textcolor{magenta}{\textbf{r2}} & \textcolor{magenta}{\textbf{r2}} & \textcolor{black}{\textbf{r2}} & & \\
      \hline
    \end{tabular}
  \label{tbl:ejemploLRTablaLR1}
  \end{table}

\subsubsection{Análisis de una cadena de entrada}

A continuación, en la tabla \ref{tbl:analisis2}, se muestra
el resultado de analizar la cadena de entrada \textbf{a d a a d}.
Esta cadena de entrada es correcta, y conduce a un análisis satisfactorio.

  \begin{table}[H]
      \begin{tabular}{|p{3cm}|p{4cm}|p{4cm}|}
	\hline \hline \textbf{Pila} & \textbf{Entrada} & \textbf{Acción} \\
	\hline \textcolor{blue}{0} & \textcolor{blue}{a} d a a d \$ & \textcolor{blue}{d} 3 \\
	\hline 0 a \textcolor{blue}{3} & \textcolor{blue}{d} a a d \$ & \textcolor{blue}{d} 4 \\
	\hline 0 a 3 \textcolor{blue}{d 4} & \textcolor{blue}{a} a d \$ & \textcolor{magenta}{r }$(3) \: C \rightarrow d $\\
	\hline 0 \textcolor{blue}{a 3 C 8} & \textcolor{blue}{a} a d \$ & \textcolor{magenta}{r }$(2) \: C \rightarrow a C $\\
	\hline 0 C \textcolor{blue}{2} & \textcolor{blue}{a} a d \$ & \textcolor{blue}{d} 6 \\
	\hline 0 C 2 a \textcolor{blue}{6} & \textcolor{blue}{a} d \$ & \textcolor{blue}{d} 6 \\
	\hline 0 C 2 a 6 a \textcolor{blue}{6} & \textcolor{blue}{d} \$ & \textcolor{blue}{d} 7 \\
	\hline 0 C 2 a 6 a 6 \textcolor{blue}{d 7} & \textcolor{blue}{\$} & \textcolor{magenta}{r }$(3) \: C \rightarrow d $\\
	\hline 0 C 2 a 6 \textcolor{blue}{a 6 C 9} & \textcolor{blue}{\$} & \textcolor{magenta}{r }$(2) \: C \rightarrow a C $\\
	\hline 0 C 2 a 6 \textcolor{blue}{C 9} & \textcolor{blue}{\$} & \textcolor{magenta}{r }$(2) \: C \rightarrow a C $\\
	\hline 0 \textcolor{blue}{C 2 C 5} & \textcolor{blue}{\$} & \textcolor{magenta}{r }$(1) \: S \rightarrow C C $\\
	\hline 0 S \textcolor{blue}{1} & \textcolor{blue}{\$} & \textcolor{verde}{ACEPTAR}\\
	\hline
    \end{tabular}
       \caption{Ejemplo LR. Tabla de análisis}
      \label{tbl:analisis2}
  \end{table}

\subsection{Ejemplo de LALR}

Sea la gramática cuyas producciones se muestran en la expresión
\ref{eq:gramaticaEjemploLALR}. A continuación, se procederá a 
construir la tabla
de análisis LR, unificar los estados (para obtener
la colección LALR resultante) y reconocer una cadena de entrada. 

   \begin{equation}
    \begin{array}{l}    
	\displaystyle P = \{ \\
	\displaystyle (1') \:\:\: S' \rightarrow S \\
	\displaystyle (1) \:\:\: S \rightarrow C \: C \\
	\displaystyle (2) \:\:\: C \rightarrow \mbox{\bf \em a} \: C \\
	\displaystyle (3) \:\:\: C \rightarrow \mbox{\bf \em d} \\
	\displaystyle \}
    \end{array} 
    \label{eq:gramaticaEjemploLALR}
  \end{equation}                


En este caso, como es la misma gramática del ejemplo anterior,
se va a proceder a unificar los estados directamente.

\subsubsection{Unificación de la colección canónica de LR(1)-elementos}

Analizando la colección canónica (la del ejemplo anterior, puesto que en
este caso se está usando la misma gramática), se observa que se pueden
unificar los siguientes estados:

\begin{itemize}
 \item Estados 3 y 6. Pasan a llamarse \textbf{estado 3}.
 \item Estados 4 y 7. Pasan a llamarse \textbf{estado 4}.
 \item Estados 5 y 8. Pasan a llamarse \textbf{estado 5}.
\end{itemize}

Una vez hecho esto, los demás estados por encima del 5 se volverán 
a enumerar para que la numeración de los estados sea secuencial.

\subsubsection{Autómata que reconoce los prefijos viables}

Una vez unificados los estados de la colección LR(1), se puede determinar un
autómata finito determinista (AFD) que reconoce los \textbf{prefijos
viables}. Véase la tabla \ref{tbl:ejemploLALRAFD} para más información.

  \begin{table}[H]
  %\footnotesize
  \caption{Ejemplo LALR. Autómata que reconoce los prefijos viables}
  \vspace{10px} 
  \centering
    \begin{tabular}{| c | c | c | c | c |}
      \hline \hline
      Estado & \textbf{S} & \textbf{C} & \textbf{a} & \textbf{d} \\ 
      \hline \textbf{0} & 1 & 2 & 3 & 4 \\ 
      \hline \textbf{1} &  &  &  &  \\ 
      \hline \textbf{2} &  & 5 & 6 & 4 \\ 
      \hline \textbf{3} &  & 5 & 3 & 4 \\ 
      \hline \textbf{4} &  &  &  &  \\ 
      \hline \textbf{5} &  &  &  &  \\ 
      \hline
    \end{tabular}
  \label{tbl:ejemploLALRAFD}
  \end{table}

En el AFD obtenido se tiene que el estado inicial es \textbf{$I_{0}$}, por
contener la regla $S' \rightarrow S$ y todos los estados del
autómata son finales. Una representación más \textit{intuitiva}
de este autómata se muestra en la figura \ref{fig:figura_lalr_afd}.

\begin{figure}[H]
  \begin{center} 
    \includegraphics[width=0.5\textwidth]{img/grafo33.jpg}
    \caption{Ejemplo LALR. Representación gráfica del AFD}
    \label{fig:figura_lalr_afd}
  \end{center}
\end{figure}

\subsubsection{Tabla LALR}

La tabla LR \textbf{unificada} se muestra en la tabla \ref{tbl:ejemploLALRTablaLR}

  \begin{table}[H]
  %\footnotesize
  \caption{Ejemplo LALR. Tabla y completada con el método de nivel de frase}
  \vspace{10px} 
  \centering
    \begin{tabular}{| c | c | c | c || c | c |}
      \hline \hline
      & \multicolumn{3}{c||}{\textcolor{blue}{\textbf{Acción}}} & \multicolumn{2}{c|}{\textcolor{blue}{\textbf{Ir-a}}} \\
      \hline \textbf{Estado} & \textbf{a} & \textbf{d} & \textbf{\$} & \textbf{S} & \textbf{C}\\ 
      \hline 0 & \textcolor{blue}{\textbf{d3}} & \textcolor{blue}{\textbf{d4}} & \textcolor{red}{\textbf{E2}} & 1 & 2 \\
      \hline 1 & \textcolor{red}{\textbf{E1}} & \textcolor{red}{\textbf{E1}} & \textcolor{verde}{ACEPTAR} & & \\
      \hline 2 & \textcolor{blue}{\textbf{d3}} & \textcolor{blue}{\textbf{d4}} & \textcolor{red}{\textbf{E2}} & & 5 \\
      \hline 3 & \textcolor{blue}{\textbf{d3}} & \textcolor{blue}{\textbf{d4}} & \textcolor{red}{\textbf{E2}} & & 5 \\
      \hline 4 & \textcolor{magenta}{\textbf{r3}} & \textcolor{magenta}{\textbf{r3}} & \textcolor{magenta}{\textbf{r3}} & & \\
      \hline 5 & \textcolor{magenta}{\textbf{r2}} & \textcolor{magenta}{\textbf{r2}} & \textcolor{magenta}{\textbf{r1}} & & \\
      \hline
    \end{tabular}
  \label{tbl:ejemploLALRTablaLR}
  \end{table}

Nótese que en este caso se han utilizado las mismas funciones de error
que en el ejemplo anterior:

\begin{itemize}
 \item \textbf{E1: Símbolo inesperado}. Se borra el símbolo de la entrada.
 \item \textbf{E2: Fin de cadena inesperado}. Se termina el análisis de forma insatisfactoria.
\end{itemize}

\subsubsection{Análisis de una cadena de entrada}

A continuación, en la tabla \ref{tbl:analisis3}, se muestra
el resultado de analizar la cadena de entrada \textbf{a d a a d}.
Esta cadena de entrada es correcta, y conduce a un análisis satisfactorio.

  \begin{table}[H]
      \begin{tabular}{|p{3cm}|p{5cm}|p{5cm}|}
	\hline \hline \textbf{Pila} & \textbf{Entrada} & \textbf{Acción} \\
	\hline \underline{0} & \underline{a} d a a d \$ & \textcolor{blue}{d} 3 \\
	\hline 0 a \underline{3} & \underline{d} a a d \$ & \textcolor{blue}{d} 4 \\
	\hline 0 a 3 \underline{d 4} & \underline{a} a d \$ & \textcolor{magenta}{r }$(3) \: C \rightarrow d $\\
	\hline 0 a 3 \underline{C 6} & \underline{a} a d \$ & \textcolor{magenta}{r }$(2) \: C \rightarrow a C $\\
	\hline 0 C \underline{2} & \underline{a} a d \$ & \textcolor{blue}{d} 3 \\
	\hline 0 C 2 a \underline{3} & \underline{a} d \$ & \textcolor{blue}{d} 3 \\
	\hline 0 C 2 a 3 a \underline{3} & \underline{d} \$ & \textcolor{blue}{d} 4 \\
	\hline 0 C 2 a 3 a 3 \underline{d 4} & \underline{\$} & \textcolor{magenta}{r }$(3) \: C \rightarrow d $\\
	\hline 0 C 2 a 3 \underline{a 3 C 6} & \underline{\$} & \textcolor{magenta}{r }$(2) \: C \rightarrow a C $\\
	\hline 0 C 2 a 3 \underline{C 6} & \underline{\$} & \textcolor{magenta}{r }$(2) \: C \rightarrow a C $\\
	\hline 0 \underline{C 2 C 5} & \underline{\$} & \textcolor{magenta}{r }$(1) \: S \rightarrow C C $\\
	\hline 0 S \underline{1} & \underline{\$} & \textcolor{verde}{ACEPTAR}\\
	\hline
    \end{tabular}
       \caption{Ejemplo LALR. Tabla de análisis}
      \label{tbl:analisis3}
  \end{table}